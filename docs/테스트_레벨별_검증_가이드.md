# í…ŒìŠ¤íŠ¸ ë ˆë²¨ë³„ ê²€ì¦ ê°€ì´ë“œ

> ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸, E2E í…ŒìŠ¤íŠ¸ì—ì„œ ê°ê° ë¬´ì—‡ì„ ê²€ì¦í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ì¢…í•© ê°€ì´ë“œ

## ëª©ì°¨

1. [í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ ê°œìš”](#í…ŒìŠ¤íŠ¸-í”¼ë¼ë¯¸ë“œ-ê°œìš”)
2. [Unit Test (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)](#1-unit-test-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸)
3. [Integration Test (í†µí•© í…ŒìŠ¤íŠ¸)](#2-integration-test-í†µí•©-í…ŒìŠ¤íŠ¸)
4. [E2E Test (End-to-End í…ŒìŠ¤íŠ¸)](#3-e2e-test-end-to-end-í…ŒìŠ¤íŠ¸)
5. [ì¢…í•© ë¹„êµ](#ì¢…í•©-ë¹„êµí‘œ)
6. [ì‹¤ì „ ê¶Œì¥ì‚¬í•­](#ì‹¤ì „-ê¶Œì¥ì‚¬í•­)

---

## í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ ê°œìš”

```
        /\
       /  \     E2E Tests (10%)
      /----\    - ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
     /------\   - API í†µì‹ 
    /--------\
   /----------\ Integration Tests (30%)
  /------------\ - ì»´í¬ë„ŒíŠ¸ í†µí•©
 /--------------\ - DB ì—°ë™
/----------------\ Unit Tests (60%)
 - ìˆœìˆ˜ ë¡œì§
 - ê°œë³„ í•¨ìˆ˜
```

### í•µì‹¬ ì›ì¹™

- **ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ ë§ì´**: Unit Testê°€ ê°€ì¥ ë§ì•„ì•¼ í•¨
- **ëŠë¦° í…ŒìŠ¤íŠ¸ë¥¼ ì ê²Œ**: E2E TestëŠ” í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤ë§Œ
- **ì¤‘ê°„ í…ŒìŠ¤íŠ¸ë¥¼ ì ì ˆíˆ**: Integration Testë¡œ í†µí•© ê²€ì¦

### ë„¤ì„ë° ê·œì¹™

1. **Context**: APIë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ì—ì„œ â€œë„˜ê²¨ì£¼ëŠ” ê°’â€
	â€¢	ì¸ì¦ í† í°
	â€¢	API ìš”ì²­ì— í•„ìš”í•œ ID
	â€¢	Body / Query / Param ê°’
  ì˜ˆ: createAuthenticatedChatTestContext()

2. **Fixture**: í…ŒìŠ¤íŠ¸ ì „ì— DBì— â€œë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘” ìƒíƒœâ€
	â€¢	ì´ë¯¸ ìƒì„±ëœ ì—”í‹°í‹°
	â€¢	ê´€ê³„ê°€ ì„¤ì •ëœ ë°ì´í„°
	â€¢	í…ŒìŠ¤íŠ¸ì˜ ê¸°ì¤€ í™˜ê²½
	â€¢	ì£¼ë¡œ Integration / Repository í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©
  ì˜ˆ: createChatRoomWithMessagesFixture()
  
---

## 1. Unit Test (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)

### ğŸ“ ëª©ì 
**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” í•¨ìˆ˜/ë©”ì„œë“œë¥¼ ê²€ì¦ (ì˜ì¡´ì„±ì€ ëª¨í‚¹)**

### íŠ¹ì§•
- âš¡ **ì†ë„**: ë§¤ìš° ë¹ ë¦„ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)
- ğŸ”§ **ì˜ì¡´ì„±**: Mock/Stub ì‚¬ìš© (ì‹¤ì œ DB/ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ì•ˆí•¨)
- ğŸ¯ **ë²”ìœ„**: Service ê³„ì¸µì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- ğŸ“Š **ë¹„ìœ¨**: ì „ì²´ í…ŒìŠ¤íŠ¸ì˜ 60%

### âš ï¸ RepositoryëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ë¶€ì í•©í•œ ì´ìœ 

**Repository íŒ¨í„´**ì€ ë‹¨ìˆœíˆ DB ì ‘ê·¼ ê³„ì¸µ(Data Access Layer)ì…ë‹ˆë‹¤:
- âŒ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì—†ìŒ**: ë‹¨ìˆœíˆ Prisma ë©”ì„œë“œë¥¼ í˜¸ì¶œë§Œ í•¨
- âŒ **ê³¼ë„í•œ ëª¨í‚¹**: ì…ë ¥ë„ ëª¨í‚¹, ì¶œë ¥ë„ ëª¨í‚¹ â†’ ì•„ë¬´ê²ƒë„ ê²€ì¦ ì•ˆ í•¨
- âŒ **í…ŒìŠ¤íŠ¸ ê°€ì¹˜ ì—†ìŒ**: "ëª¨í‚¹ëœ ê°’ì„ í˜¸ì¶œí•˜ë©´ ëª¨í‚¹ëœ ê°’ì´ ë°˜í™˜ëœë‹¤"ë§Œ í™•ì¸
- âœ… **í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì í•©**: ì‹¤ì œ DBë¥¼ ì‚¬ìš©í•´ì„œ CRUDê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦

```typescript
// âŒ ë‚˜ìœ ì˜ˆ: Repository ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì˜ë¯¸ ì—†ìŒ)
describe('NotificationsRepository', () => {
  it('create í˜¸ì¶œ ì‹œ ëª¨í‚¹ëœ ê°’ ë°˜í™˜', async () => {
    const mockData = { userId: 'user-123', ... };
    const mockResult = { id: 'notif-1', ...mockData };

    // ì…ë ¥ë„ ëª¨í‚¹
    jest.spyOn(prisma.notification, 'create')
      .mockResolvedValue(mockResult); // ì¶œë ¥ë„ ëª¨í‚¹

    const result = await repository.create(mockData);

    // ì´ê²Œ ë­˜ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê±´ê°€? ğŸ¤”
    // "ëª¨í‚¹í•˜ë©´ ëª¨í‚¹ëœ ê°’ì´ ë°˜í™˜ëœë‹¤"ë§Œ í™•ì¸í•˜ëŠ” ë¬´ì˜ë¯¸í•œ í…ŒìŠ¤íŠ¸
    expect(result).toEqual(mockResult);
  });
});

// âœ… ì˜¬ë°”ë¥¸ ì ‘ê·¼: RepositoryëŠ” í†µí•© í…ŒìŠ¤íŠ¸ë¡œ (ì„¹ì…˜ 2 ì°¸ê³ )
describe('NotificationsRepository í†µí•© í…ŒìŠ¤íŠ¸', () => {
  it('ì‹¤ì œ DBì— ì €ì¥í•˜ê³  ì¡°íšŒí•  ìˆ˜ ìˆë‹¤', async () => {
    // ì‹¤ì œ DB ì‚¬ìš©
    const result = await repository.create({
      userId: testUserId,
      type: NotificationType.NEW_MESSAGE,
      title: 'í…ŒìŠ¤íŠ¸',
      message: 'ë©”ì‹œì§€',
    });

    // ì‹¤ì œë¡œ DBì— ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
    const saved = await prisma.notification.findUnique({
      where: { id: result.id },
    });

    expect(saved).not.toBeNull();
    expect(saved.title).toBe('í…ŒìŠ¤íŠ¸');
  });
});
```

### âœ… Service ê³„ì¸µ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì í•©)

**ServiceëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆìœ¼ë¯€ë¡œ** ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ì í•©í•©ë‹ˆë‹¤:
- âœ… Repositoryë¥¼ ëª¨í‚¹í•˜ê³  Service ë¡œì§ë§Œ ê²€ì¦
- âœ… ì˜ì¡´ì„± í˜¸ì¶œ ì—¬ë¶€, í˜¸ì¶œ ì¸ì, ë°˜í™˜ê°’ ê²€ì¦
- âœ… ì˜ˆì™¸ ì²˜ë¦¬, ì¡°ê±´ ë¶„ê¸° ë¡œì§ ê²€ì¦

#### Service ë ˆì´ì–´ ì˜ˆì‹œ

```typescript
// notifications.service.spec.ts
describe('NotificationsService', () => {
  let service: NotificationsService;
  let repository: NotificationsRepository;

  beforeEach(() => {
    // Mock Repository
    repository = {
      create: jest.fn(),
      findMany: jest.fn(),
      markAsRead: jest.fn(),
      getUnreadCount: jest.fn(),
    } as any;

    service = new NotificationsService(repository);
  });

  describe('create', () => {
    it('Repositoryì˜ createë¥¼ í˜¸ì¶œí•œë‹¤', async () => {
      const mockData = {
        userId: 'user-123',
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      };
      const mockResult = { id: 'notif-1', ...mockData };

      (repository.create as jest.Mock).mockResolvedValue(mockResult);

      const result = await service.create(mockData);

      expect(repository.create).toHaveBeenCalledWith(mockData);
      expect(result).toEqual(mockResult);
    });
  });

  describe('findMyNotifications', () => {
    it('í˜ì´ì§€ë„¤ì´ì…˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤', async () => {
      const mockResult = {
        items: [{ id: 'notif-1' }],
        total: 10,
        page: 1,
        totalPages: 1,
        unreadCount: 5,
      };

      (repository.findMany as jest.Mock).mockResolvedValue(mockResult);

      const result = await service.findMyNotifications('user-123', 1);

      expect(repository.findMany).toHaveBeenCalledWith('user-123', 1);
      expect(result).toEqual(mockResult);
    });
  });

  describe('markAsRead', () => {
    it('ê¶Œí•œì´ ìˆìœ¼ë©´ ì½ìŒ ì²˜ë¦¬í•œë‹¤', async () => {
      (repository.markAsRead as jest.Mock).mockResolvedValue({ count: 1 });

      await service.markAsRead('notif-1', 'user-123');

      expect(repository.markAsRead).toHaveBeenCalledWith('notif-1', 'user-123');
    });

    it('ê¶Œí•œì´ ì—†ìœ¼ë©´ 0ê±´ ì—…ë°ì´íŠ¸ëœë‹¤', async () => {
      (repository.markAsRead as jest.Mock).mockResolvedValue({ count: 0 });

      await service.markAsRead('notif-1', 'wrong-user');

      expect(repository.markAsRead).toHaveBeenCalledWith('notif-1', 'wrong-user');
    });
  });
});
```

### ğŸ“‹ Unit Test ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ê° ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìë¡œ ì˜ì¡´ì„±ì„ í˜¸ì¶œí•˜ëŠ”ê°€?
- [ ] ë°˜í™˜ê°’ì´ ì˜ˆìƒëŒ€ë¡œì¸ê°€?
- [ ] ì—£ì§€ ì¼€ì´ìŠ¤(null, undefined, ë¹ˆ ë°°ì—´)ë¥¼ ì²˜ë¦¬í•˜ëŠ”ê°€?
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ëŠ”ê°€?
- [ ] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ê³„ì‚°, ë³€í™˜)ì´ ì •í™•í•œê°€?

### âŒ Unit Testì—ì„œ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ

- ì‹¤ì œ DB ì—°ê²°
- ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ
- íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼
- ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜ì¡´

---

## 2. Integration Test (í†µí•© í…ŒìŠ¤íŠ¸)

### ğŸ“ ëª©ì 
**ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ í•¨ê»˜ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦ (ì‹¤ì œ DB ì‚¬ìš©)**

### íŠ¹ì§•
- âš¡ **ì†ë„**: ë³´í†µ (ì´ˆ ë‹¨ìœ„)
- ğŸ”§ **ì˜ì¡´ì„±**: ì‹¤ì œ DB ì‚¬ìš© (í…ŒìŠ¤íŠ¸ DB)
- ğŸ¯ **ë²”ìœ„**: Repository + DB ë˜ëŠ” Service + Repository + DB
- ğŸ“Š **ë¹„ìœ¨**: ì „ì²´ í…ŒìŠ¤íŠ¸ì˜ 30%

### âœ… Repository í†µí•© í…ŒìŠ¤íŠ¸ (ê¶Œì¥)

**RepositoryëŠ” í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ì‘ì„±í•˜ì„¸ìš”!**
- âœ… ì‹¤ì œ DBì— ì €ì¥/ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦
- âœ… Prisma ìŠ¤í‚¤ë§ˆì˜ ì œì•½ì¡°ê±´(UNIQUE, NOT NULL ë“±) ê²€ì¦
- âœ… ë³µì¡í•œ ì¿¼ë¦¬(JOIN, ì§‘ê³„, í˜ì´ì§€ë„¤ì´ì…˜) ì •í™•ì„± ê²€ì¦
- âœ… íŠ¸ëœì­ì…˜ ë¡¤ë°± ë™ì‘ ê²€ì¦

```typescript
// notifications.repository.integration.spec.ts
describe('NotificationsRepository í†µí•© í…ŒìŠ¤íŠ¸', () => {
  let repository: NotificationsRepository;
  let prisma: PrismaService;
  let testUserId: string;

  beforeAll(async () => {
    const module = await Test.createTestingModule({
      providers: [NotificationsRepository, PrismaService],
    }).compile();

    repository = module.get<NotificationsRepository>(NotificationsRepository);
    prisma = module.get<PrismaService>(PrismaService);
  });

  beforeEach(async () => {
    // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±
    const user = await prisma.user.create({
      data: {
        email: `test-${Date.now()}@example.com`,
        password: 'hashed',
        nickname: 'í…ŒìŠ¤í„°',
      },
    });
    testUserId = user.id;
  });

  afterEach(async () => {
    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
    await prisma.notification.deleteMany({ where: { userId: testUserId } });
    await prisma.user.delete({ where: { id: testUserId } });
  });

  describe('create', () => {
    it('ì•Œë¦¼ì„ DBì— ì €ì¥í•˜ê³  ìƒì„±ëœ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤', async () => {
      // Given: ì•Œë¦¼ ìƒì„± ë°ì´í„°
      const createData = {
        userId: testUserId,
        type: NotificationType.NEW_MESSAGE,
        title: 'ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
        message: 'ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.',
      };

      // When: ì•Œë¦¼ ìƒì„±
      const result = await repository.create(createData);

      // Then: ë°˜í™˜ëœ ê°ì²´ ê²€ì¦
      expect(result).toMatchObject({
        id: expect.any(String),
        userId: testUserId,
        type: NotificationType.NEW_MESSAGE,
        title: 'ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
        message: 'ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.',
        isRead: false,
        readAt: null,
        createdAt: expect.any(Date),
      });

      // Then: ì‹¤ì œë¡œ DBì— ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
      const saved = await prisma.notification.findUnique({
        where: { id: result.id },
      });

      expect(saved).not.toBeNull();
      expect(saved.title).toBe('ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼');
    });

    it('relatedIdì™€ relatedTypeì„ í¬í•¨í•œ ì•Œë¦¼ì„ ìƒì„±í•œë‹¤', async () => {
      const createData = {
        userId: testUserId,
        type: NotificationType.ORDER_CONFIRMED,
        title: 'ì£¼ë¬¸ í™•ì¸',
        message: 'ì£¼ë¬¸ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
        relatedId: 'order-123',
        relatedType: 'Order',
      };

      const result = await repository.create(createData);

      expect(result.relatedId).toBe('order-123');
      expect(result.relatedType).toBe('Order');

      // DB í™•ì¸
      const saved = await prisma.notification.findUnique({
        where: { id: result.id },
      });
      expect(saved.relatedId).toBe('order-123');
    });
  });

  describe('findMany', () => {
    beforeEach(async () => {
      // í…ŒìŠ¤íŠ¸ìš© ì•Œë¦¼ 3ê°œ ìƒì„±
      await Promise.all([
        repository.create({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'ì•Œë¦¼1',
          message: 'ë©”ì‹œì§€1',
        }),
        repository.create({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'ì•Œë¦¼2',
          message: 'ë©”ì‹œì§€2',
        }),
        repository.create({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'ì•Œë¦¼3',
          message: 'ë©”ì‹œì§€3',
        }),
      ]);
    });

    it('í˜ì´ì§€ë„¤ì´ì…˜ì´ ì •ìƒ ì‘ë™í•œë‹¤', async () => {
      // 1í˜ì´ì§€ (limit: 2)
      const page1 = await repository.findMany(testUserId, 1, 2);

      expect(page1.items).toHaveLength(2);
      expect(page1.total).toBe(3);
      expect(page1.page).toBe(1);
      expect(page1.totalPages).toBe(2);

      // 2í˜ì´ì§€
      const page2 = await repository.findMany(testUserId, 2, 2);

      expect(page2.items).toHaveLength(1);
      expect(page2.page).toBe(2);
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì¡°íšŒë˜ì§€ ì•ŠëŠ”ë‹¤', async () => {
      // ë‹¤ë¥¸ ì‚¬ìš©ì ìƒì„±
      const otherUser = await prisma.user.create({
        data: {
          email: `other-${Date.now()}@example.com`,
          password: 'hashed',
          nickname: 'ë‹¤ë¥¸ì‚¬ìš©ì',
        },
      });

      // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ ìƒì„±
      await repository.create({
        userId: otherUser.id,
        type: NotificationType.NEW_MESSAGE,
        title: 'ë‹¤ë¥¸ ì‚¬ìš©ì ì•Œë¦¼',
        message: 'ë©”ì‹œì§€',
      });

      // ë‚´ ì•Œë¦¼ë§Œ ì¡°íšŒë¨
      const result = await repository.findMany(testUserId, 1, 10);

      expect(result.items).toHaveLength(3); // ë‚´ ì•Œë¦¼ 3ê°œë§Œ
      expect(result.items.every(n => n.userId === testUserId)).toBe(true);

      // ì •ë¦¬
      await prisma.notification.deleteMany({ where: { userId: otherUser.id } });
      await prisma.user.delete({ where: { id: otherUser.id } });
    });
  });

  describe('markAsRead', () => {
    it('ë³¸ì¸ ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤', async () => {
      // ì•Œë¦¼ ìƒì„±
      const notification = await repository.create({
        userId: testUserId,
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      expect(notification.isRead).toBe(false);

      // ì½ìŒ ì²˜ë¦¬
      const result = await repository.markAsRead(notification.id, testUserId);

      expect(result.count).toBe(1); // 1ê±´ ì—…ë°ì´íŠ¸

      // DB í™•ì¸
      const updated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(updated.isRead).toBe(true);
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤', async () => {
      // ë‹¤ë¥¸ ì‚¬ìš©ì ìƒì„±
      const otherUser = await prisma.user.create({
        data: {
          email: `other-${Date.now()}@example.com`,
          password: 'hashed',
          nickname: 'ë‹¤ë¥¸ì‚¬ìš©ì',
        },
      });

      // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼
      const notification = await repository.create({
        userId: otherUser.id,
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      // ë‚´ê°€ ì½ìŒ ì²˜ë¦¬ ì‹œë„
      const result = await repository.markAsRead(notification.id, testUserId);

      // ê¶Œí•œ ì—†ìŒ - 0ê±´ ì—…ë°ì´íŠ¸
      expect(result.count).toBe(0);

      // DB í™•ì¸ - ì—¬ì „íˆ ì½ì§€ ì•ŠìŒ ìƒíƒœ
      const notUpdated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(notUpdated.isRead).toBe(false);

      // ì •ë¦¬
      await prisma.notification.delete({ where: { id: notification.id } });
      await prisma.user.delete({ where: { id: otherUser.id } });
    });
  });

  describe('delete', () => {
    it('ë³¸ì¸ ì•Œë¦¼ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤', async () => {
      // ì•Œë¦¼ ìƒì„±
      const notification = await repository.create({
        userId: testUserId,
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      // ì‚­ì œ
      const deleted = await repository.delete(notification.id, testUserId);

      expect(deleted.id).toBe(notification.id);

      // DB í™•ì¸ - ì‚­ì œë¨
      const notFound = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(notFound).toBeNull();
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì‚­ì œí•  ìˆ˜ ì—†ë‹¤', async () => {
      // ë‹¤ë¥¸ ì‚¬ìš©ì ìƒì„±
      const otherUser = await prisma.user.create({
        data: {
          email: `other-${Date.now()}@example.com`,
          password: 'hashed',
          nickname: 'ë‹¤ë¥¸ì‚¬ìš©ì',
        },
      });

      // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼
      const notification = await repository.create({
        userId: otherUser.id,
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      // ë‚´ê°€ ì‚­ì œ ì‹œë„ - ì—ëŸ¬ ë°œìƒ ì˜ˆìƒ
      await expect(
        repository.delete(notification.id, testUserId)
      ).rejects.toThrow();

      // DB í™•ì¸ - ì—¬ì „íˆ ì¡´ì¬
      const stillExists = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(stillExists).not.toBeNull();

      // ì •ë¦¬
      await prisma.notification.delete({ where: { id: notification.id } });
      await prisma.user.delete({ where: { id: otherUser.id } });
    });
  });

  afterAll(async () => {
    await prisma.$disconnect();
  });
});
```

### âœ… Service + Repository + DB í†µí•© í…ŒìŠ¤íŠ¸

```typescript
// notifications.integration.spec.ts
describe('NotificationsModule Integration', () => {
  let module: TestingModule;
  let service: NotificationsService;
  let repository: NotificationsRepository;
  let prisma: PrismaService;

  beforeAll(async () => {
    module = await Test.createTestingModule({
      imports: [
        ConfigModule.forRoot(),
        PrismaModule,  // âœ… ì‹¤ì œ Prisma ì‚¬ìš©
      ],
      providers: [NotificationsService, NotificationsRepository],
    }).compile();

    service = module.get(NotificationsService);
    repository = module.get(NotificationsRepository);
    prisma = module.get(PrismaService);
  });

  beforeEach(async () => {
    // í…ŒìŠ¤íŠ¸ ì „ ë°ì´í„° ì •ë¦¬
    await prisma.notification.deleteMany();
  });

  describe('ì•Œë¦¼ ìƒì„± â†’ ì¡°íšŒ', () => {
    it('ìƒì„±í•œ ì•Œë¦¼ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤', async () => {
      // 1. Serviceë¥¼ í†µí•œ ì•Œë¦¼ ìƒì„±
      const created = await service.create({
        userId: 'user-123',
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      expect(created.id).toBeDefined();
      expect(created.userId).toBe('user-123');

      // 2. Repositoryë¥¼ í†µí•œ ì§ì ‘ ì¡°íšŒ
      const result = await repository.findMany('user-123', 1);

      // âœ… ìƒì„±ëœ ì•Œë¦¼ì´ ì¡°íšŒë˜ëŠ”ì§€ ê²€ì¦
      expect(result.items).toHaveLength(1);
      expect(result.items[0].id).toBe(created.id);
    });
  });

  describe('ì½ìŒ ì²˜ë¦¬', () => {
    it('ë³¸ì¸ ì†Œìœ ì˜ ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤', async () => {
      // ì•Œë¦¼ ìƒì„±
      const notification = await service.create({
        userId: 'user-123',
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      expect(notification.isRead).toBe(false);

      // ì½ìŒ ì²˜ë¦¬
      await service.markAsRead(notification.id, 'user-123');

      // âœ… DBì—ì„œ ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸
      const updated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(updated.isRead).toBe(true);
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤', async () => {
      // ì‚¬ìš©ì Aì˜ ì•Œë¦¼ ìƒì„±
      const notification = await service.create({
        userId: 'user-A',
        type: NotificationType.NEW_MESSAGE,
        title: 'í…ŒìŠ¤íŠ¸',
        message: 'ë©”ì‹œì§€',
      });

      // ì‚¬ìš©ì Bê°€ ì½ìŒ ì²˜ë¦¬ ì‹œë„
      const result = await service.markAsRead(notification.id, 'user-B');

      // âœ… ê¶Œí•œ ê²€ì¦
      expect(result.count).toBe(0);

      // DBì—ì„œ í™•ì¸ - ì—¬ì „íˆ ì½ì§€ ì•ŠìŒ ìƒíƒœ
      const notUpdated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(notUpdated.isRead).toBe(false);
    });
  });

  describe('í˜ì´ì§€ë„¤ì´ì…˜', () => {
    it('20ê°œì”© í˜ì´ì§€ë„¤ì´ì…˜ëœë‹¤', async () => {
      // 25ê°œ ì•Œë¦¼ ìƒì„±
      const promises = Array.from({ length: 25 }, (_, i) =>
        service.create({
          userId: 'user-123',
          type: NotificationType.NEW_MESSAGE,
          title: `ì•Œë¦¼ ${i + 1}`,
          message: 'ë©”ì‹œì§€',
        })
      );

      await Promise.all(promises);

      // 1í˜ì´ì§€ ì¡°íšŒ
      const page1 = await service.findMyNotifications('user-123', 1);

      // âœ… í˜ì´ì§€ë„¤ì´ì…˜ ê²€ì¦
      expect(page1.items).toHaveLength(20);
      expect(page1.total).toBe(25);
      expect(page1.totalPages).toBe(2);

      // 2í˜ì´ì§€ ì¡°íšŒ
      const page2 = await service.findMyNotifications('user-123', 2);

      expect(page2.items).toHaveLength(5);
    });
  });

  describe('ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°œìˆ˜', () => {
    it('ì½ì§€ ì•Šì€ ì•Œë¦¼ ê°œìˆ˜ë¥¼ ì •í™•íˆ ë°˜í™˜í•œë‹¤', async () => {
      // 5ê°œ ì•Œë¦¼ ìƒì„±
      const notifications = await Promise.all(
        Array.from({ length: 5 }, () =>
          service.create({
            userId: 'user-123',
            type: NotificationType.NEW_MESSAGE,
            title: 'í…ŒìŠ¤íŠ¸',
            message: 'ë©”ì‹œì§€',
          })
        )
      );

      // 2ê°œ ì½ìŒ ì²˜ë¦¬
      await service.markAsRead(notifications[0].id, 'user-123');
      await service.markAsRead(notifications[1].id, 'user-123');

      // ì½ì§€ ì•Šì€ ê°œìˆ˜ í™•ì¸
      const count = await service.getUnreadCount('user-123');

      // âœ… ì •í™•í•œ ê°œìˆ˜ ê²€ì¦
      expect(count).toBe(3);
    });
  });

  afterAll(async () => {
    await prisma.$disconnect();
    await module.close();
  });
});
```

### ğŸ“‹ Integration Test ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Service + Repository + DB í†µí•© ë™ì‘í•˜ëŠ”ê°€?
- [ ] íŠ¸ëœì­ì…˜ì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ê°€?
- [ ] ë°ì´í„° ì •í•©ì„±ì´ ìœ ì§€ë˜ëŠ”ê°€?
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ì´ ì •í™•í•œê°€?
- [ ] ê¶Œí•œ ê²€ì¦ì´ ì‹¤ì œ DB ë ˆë²¨ì—ì„œ ë™ì‘í•˜ëŠ”ê°€?
- [ ] ì—°ê´€ ë°ì´í„° ì²˜ë¦¬ê°€ ì •í™•í•œê°€?

### âŒ Integration Testì—ì„œ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ

- HTTP ìš”ì²­/ì‘ë‹µ í…ŒìŠ¤íŠ¸ (E2Eì˜ ì˜ì—­)
- ëª¨ë“  ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (Unit Testì˜ ì˜ì—­)
- ì™¸ë¶€ API í˜¸ì¶œ (Mock ì²˜ë¦¬)

---

## 3. E2E Test (End-to-End í…ŒìŠ¤íŠ¸)

### ğŸ“ ëª©ì 
**ì‹¤ì œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ë¥¼ HTTP APIë¥¼ í†µí•´ ê²€ì¦**

### íŠ¹ì§•
- âš¡ **ì†ë„**: ëŠë¦¼ (ì´ˆ~ë¶„ ë‹¨ìœ„)
- ğŸ”§ **ì˜ì¡´ì„±**: ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤íƒ
- ğŸ¯ **ë²”ìœ„**: HTTP â†’ Controller â†’ Service â†’ Repository â†’ DB
- ğŸ“Š **ë¹„ìœ¨**: ì „ì²´ í…ŒìŠ¤íŠ¸ì˜ 10%

### âœ… ê²€ì¦ ëŒ€ìƒ

```typescript
// notifications.e2e.spec.ts
describe('NotificationsController (E2E)', () => {
  let app: INestApplication;
  let prisma: PrismaService;
  let testUserToken: string;
  let testUserId: string;

  beforeAll(async () => {
    const moduleFixture = await Test.createTestingModule({
      imports: [AppModule],  // âœ… ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜
    }).compile();

    app = moduleFixture.createNestApplication();

    // âœ… ì‹¤ì œ ìš´ì˜ í™˜ê²½ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
    app.setGlobalPrefix('api/v1');
    app.useGlobalPipes(new ValidationPipe());
    app.useGlobalInterceptors(new TransformInterceptor());

    await app.init();

    prisma = app.get(PrismaService);

    // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ë° í† í° ë°œê¸‰
    const user = await createTestUser(prisma);
    testUserId = user.id;
    testUserToken = generateJwtToken(user);
  });

  beforeEach(async () => {
    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
    await prisma.notification.deleteMany({ where: { userId: testUserId } });
  });

  describe('POST /api/v1/notifications', () => {
    it('ì•Œë¦¼ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤', async () => {
      const { body } = await request(app.getHttpServer())
        .post('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .send({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
          message: 'ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.',
        })
        .expect(201);  // âœ… HTTP ìƒíƒœ ì½”ë“œ

      // âœ… ì‘ë‹µ êµ¬ì¡° ê²€ì¦
      expect(body.success).toBe(true);
      expect(body.statusCode).toBe(201);
      expect(body.data).toMatchObject({
        title: 'ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
        message: 'ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.',
        type: NotificationType.NEW_MESSAGE,
        isRead: false,
      });
      expect(body.data.id).toBeDefined();
      expect(body.timestamp).toBeDefined();
    });

    it('ì¸ì¦ ì—†ì´ ìš”ì²­í•˜ë©´ 401 ì—ëŸ¬', async () => {
      await request(app.getHttpServer())
        .post('/api/v1/notifications')
        .send({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'í…ŒìŠ¤íŠ¸',
          message: 'ë©”ì‹œì§€',
        })
        .expect(401);  // âœ… ì¸ì¦ ì‹¤íŒ¨
    });

    it('í•„ìˆ˜ í•„ë“œ ëˆ„ë½ ì‹œ 400 ì—ëŸ¬', async () => {
      await request(app.getHttpServer())
        .post('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .send({
          userId: testUserId,
          // type ëˆ„ë½
          title: 'í…ŒìŠ¤íŠ¸',
        })
        .expect(400);  // âœ… ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨
    });
  });

  describe('GET /api/v1/notifications', () => {
    it('ë‚´ ì•Œë¦¼ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤', async () => {
      // ì‚¬ì „ ë°ì´í„° ìƒì„±
      await createTestNotifications(prisma, testUserId, 3);

      const { body } = await request(app.getHttpServer())
        .get('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      // âœ… ì‘ë‹µ êµ¬ì¡° ê²€ì¦
      expect(body.success).toBe(true);
      expect(body.data.items).toHaveLength(3);
      expect(body.data.total).toBe(3);
      expect(body.data.page).toBe(1);
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì¡°íšŒë˜ì§€ ì•ŠëŠ”ë‹¤', async () => {
      // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ ìƒì„±
      const otherUser = await createTestUser(prisma);
      await createTestNotifications(prisma, otherUser.id, 5);

      const { body } = await request(app.getHttpServer())
        .get('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      // âœ… ê¶Œí•œ ê²€ì¦
      expect(body.data.items).toHaveLength(0);
    });
  });

  describe('PATCH /api/v1/notifications/:id/read', () => {
    it('ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤', async () => {
      // ì•Œë¦¼ ìƒì„±
      const notification = await prisma.notification.create({
        data: {
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'í…ŒìŠ¤íŠ¸',
          message: 'ë©”ì‹œì§€',
        },
      });

      await request(app.getHttpServer())
        .patch(`/api/v1/notifications/${notification.id}/read`)
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      // âœ… ì‹¤ì œ DB í™•ì¸
      const updated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(updated.isRead).toBe(true);
    });

    it('ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼ì€ ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤', async () => {
      // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì•Œë¦¼
      const otherUser = await createTestUser(prisma);
      const notification = await prisma.notification.create({
        data: {
          userId: otherUser.id,
          type: NotificationType.NEW_MESSAGE,
          title: 'í…ŒìŠ¤íŠ¸',
          message: 'ë©”ì‹œì§€',
        },
      });

      await request(app.getHttpServer())
        .patch(`/api/v1/notifications/${notification.id}/read`)
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);  // 200ì´ì§€ë§Œ ì‹¤ì œë¡œ ì—…ë°ì´íŠ¸ ì•ˆë¨

      // âœ… DB í™•ì¸ - ì—¬ì „íˆ ì½ì§€ ì•ŠìŒ ìƒíƒœ
      const notUpdated = await prisma.notification.findUnique({
        where: { id: notification.id },
      });

      expect(notUpdated.isRead).toBe(false);
    });
  });

  describe('ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤: ì•Œë¦¼ ìƒì• ì£¼ê¸°', () => {
    it('ìƒì„± â†’ ì¡°íšŒ â†’ ì½ìŒ ì²˜ë¦¬ â†’ ê°œìˆ˜ í™•ì¸', async () => {
      // 1. ì•Œë¦¼ ìƒì„±
      const created = await request(app.getHttpServer())
        .post('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .send({
          userId: testUserId,
          type: NotificationType.NEW_MESSAGE,
          title: 'ìƒˆ ë©”ì‹œì§€',
          message: 'ë©”ì‹œì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤',
        })
        .expect(201);

      const notificationId = created.body.data.id;

      // 2. ì½ì§€ ì•Šì€ ê°œìˆ˜ í™•ì¸
      const unreadBefore = await request(app.getHttpServer())
        .get('/api/v1/notifications/unread/count')
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      expect(unreadBefore.body.data.unreadCount).toBe(1);

      // 3. ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ
      const list = await request(app.getHttpServer())
        .get('/api/v1/notifications')
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      expect(list.body.data.items).toContainEqual(
        expect.objectContaining({ id: notificationId, isRead: false })
      );

      // 4. ì½ìŒ ì²˜ë¦¬
      await request(app.getHttpServer())
        .patch(`/api/v1/notifications/${notificationId}/read`)
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      // 5. ì½ì§€ ì•Šì€ ê°œìˆ˜ ë‹¤ì‹œ í™•ì¸
      const unreadAfter = await request(app.getHttpServer())
        .get('/api/v1/notifications/unread/count')
        .set('Authorization', `Bearer ${testUserToken}`)
        .expect(200);

      expect(unreadAfter.body.data.unreadCount).toBe(0);
    });
  });

  afterAll(async () => {
    await prisma.$disconnect();
    await app.close();
  });
});
```

### ğŸ“‹ E2E Test ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] HTTP ìƒíƒœ ì½”ë“œê°€ ì˜¬ë°”ë¥¸ê°€?
- [ ] ì¸ì¦/ì¸ê°€ê°€ ì‘ë™í•˜ëŠ”ê°€?
- [ ] ìœ íš¨ì„± ê²€ì¦ì´ ì‘ë™í•˜ëŠ”ê°€?
- [ ] ì‘ë‹µ í˜•ì‹ì´ ì¼ê´€ëœê°€? (TransformInterceptor)
- [ ] ì‹¤ì œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ê°€ ë™ì‘í•˜ëŠ”ê°€?
- [ ] ê¶Œí•œì´ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¦¬ë˜ëŠ”ê°€?
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ê°€ ì ì ˆíˆ ì²˜ë¦¬ë˜ëŠ”ê°€?

### âŒ E2E Testì—ì„œ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ

- ëª¨ë“  í•„ë“œì˜ íƒ€ì…ê³¼ ê°’ ê²€ì¦ (Unit Testì˜ ì˜ì—­)
- Prisma ìŠ¤í‚¤ë§ˆì˜ ê¸°ë³¸ê°’ ê²€ì¦ (DB ë ˆë²¨ í…ŒìŠ¤íŠ¸)
- ëª¨ë“  ì—£ì§€ ì¼€ì´ìŠ¤ (Unit Testì˜ ì˜ì—­)
- ì„¸ë¶€ ë¡œì§ ê²€ì¦ (Unit/Integration Testì˜ ì˜ì—­)

---

## ì¢…í•© ë¹„êµí‘œ

| í•­ëª© | Unit Test | Integration Test | E2E Test |
|------|-----------|------------------|----------|
| **ì†ë„** | ë§¤ìš° ë¹ ë¦„ (ms) | ë³´í†µ (ì´ˆ) | ëŠë¦¼ (ì´ˆ~ë¶„) |
| **ë²”ìœ„** | ë‹¨ì¼ í•¨ìˆ˜/ë©”ì„œë“œ | ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ | ì „ì²´ ì‹œìŠ¤í…œ |
| **ì˜ì¡´ì„±** | Mock | ì‹¤ì œ DB | ì‹¤ì œ ì „ì²´ ìŠ¤íƒ |
| **ê²€ì¦ ëŒ€ìƒ** | ë¡œì§ ì •í™•ì„± | í†µí•© ë™ì‘ | ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ |
| **ë¹„ìœ¨** | 60% | 30% | 10% |
| **ì˜ˆì‹œ** | ê³„ì‚° ë¡œì§ | Service+Repository | HTTP API í˜¸ì¶œ |
| **ì‹¤í–‰ í™˜ê²½** | ê²©ë¦¬ëœ í™˜ê²½ | í…ŒìŠ¤íŠ¸ DB | ì „ì²´ ì•± ìŠ¤íƒ |
| **ìœ ì§€ë³´ìˆ˜** | ì‰¬ì›€ | ë³´í†µ | ì–´ë ¤ì›€ |

---

## ì‹¤ì „ ê¶Œì¥ì‚¬í•­

### âœ… ê° ë ˆë²¨ì—ì„œ **ë°˜ë“œì‹œ** ê²€ì¦í•  ê²ƒ

#### Unit Test
- âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì •í™•ì„±
- âœ… ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬
- âœ… ì˜ì¡´ì„± í˜¸ì¶œ ê²€ì¦
- âœ… ë°˜í™˜ê°’ ì •í™•ì„±
- âœ… ì—ëŸ¬ ì²˜ë¦¬

#### Integration Test
- âœ… DB íŠ¸ëœì­ì…˜
- âœ… ë°ì´í„° ì •í•©ì„±
- âœ… ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹ 
- âœ… ë³µì¡í•œ ì¿¼ë¦¬ ë™ì‘
- âœ… ê¶Œí•œ ê²€ì¦ (DB ë ˆë²¨)

#### E2E Test
- âœ… HTTP ìƒíƒœ ì½”ë“œ
- âœ… ì¸ì¦/ì¸ê°€
- âœ… ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
- âœ… ì‘ë‹µ í˜•ì‹ ì¼ê´€ì„±
- âœ… ì‹¤ì œ ë™ì‘ ê²€ì¦

### ğŸ¯ í…ŒìŠ¤íŠ¸ ì‘ì„± ìš°ì„ ìˆœìœ„

1. **Unit Test** ë¨¼ì € (ë¹ ë¥´ê³  ë§ì´)
   - ëª¨ë“  Repository ë©”ì„œë“œ
   - ëª¨ë“  Service ë©”ì„œë“œ
   - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” í•¨ìˆ˜

2. **Integration Test** ì¤‘ê°„ (í•µì‹¬ íë¦„)
   - CRUD í†µí•© ì‹œë‚˜ë¦¬ì˜¤
   - íŠ¸ëœì­ì…˜ì´ í•„ìš”í•œ ê²½ìš°
   - ë³µì¡í•œ ì¿¼ë¦¬ ë™ì‘

3. **E2E Test** ë§ˆì§€ë§‰ (ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤ë§Œ)
   - í•µì‹¬ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
   - ì¸ì¦/ì¸ê°€ íë¦„
   - ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

### ğŸ’¡ í…ŒìŠ¤íŠ¸ íš¨ìœ¨í™” íŒ

#### 1. **ê³¼ë„í•œ ê²€ì¦ í”¼í•˜ê¸°**
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: E2Eì—ì„œ ëª¨ë“  í•„ë“œ ê²€ì¦
expect(body.data.id).toBeDefined();
expect(body.data.userId).toBe(testUserId);
expect(body.data.type).toBe('NEW_MESSAGE');
expect(body.data.title).toBe('ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼');
expect(body.data.message).toBe('ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
expect(body.data.isRead).toBe(false);
expect(body.data.readAt).toBeNull();
expect(body.data.createdAt).toBeDefined();
// ... ì´ê±´ Unit Testì—ì„œ í•´ì•¼ í•  ì¼

// âœ… ì¢‹ì€ ì˜ˆ: E2EëŠ” í•µì‹¬ë§Œ ê²€ì¦
expect(body.success).toBe(true);
expect(body.data).toMatchObject({
  title: 'ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
  message: 'ì•Œë¦¼ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.',
  type: NotificationType.NEW_MESSAGE,
  isRead: false,
});
expect(body.data.id).toBeDefined();
```

#### 2. **ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ í™œìš©**
```typescript
// ë§ì€ í•„ë“œë¥¼ ê²€ì¦í•´ì•¼ í•œë‹¤ë©´ ìŠ¤ëƒ…ìƒ· ì‚¬ìš©
expect({
  ...body.data,
  id: expect.any(String),
  createdAt: expect.any(String),
}).toMatchSnapshot();
```

#### 3. **í—¬í¼ í•¨ìˆ˜ í™œìš©**
```typescript
// ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê²€ì¦ í•¨ìˆ˜
const expectValidNotification = (notification: any) => {
  expect(notification).toMatchObject({
    id: expect.any(String),
    userId: expect.any(String),
    type: expect.any(String),
    title: expect.any(String),
    message: expect.any(String),
    isRead: expect.any(Boolean),
    createdAt: expect.any(String),
  });
};

// í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©
it('ì•Œë¦¼ ìƒì„±', async () => {
  const { body } = await request(app.getHttpServer())
    .post('/api/v1/notifications')
    .send({ ... })
    .expect(201);

  expectValidNotification(body.data);
  expect(body.data.title).toBe('ğŸ“£ í…ŒìŠ¤íŠ¸ ì•Œë¦¼');
});
```

#### 4. **ì‹œë‚˜ë¦¬ì˜¤ ì¤‘ì‹¬ E2E ì‘ì„±**
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ê°œë³„ ì—”ë“œí¬ì¸íŠ¸ë§Œ í…ŒìŠ¤íŠ¸
it('ì•Œë¦¼ ìƒì„±', async () => { ... });
it('ì•Œë¦¼ ì¡°íšŒ', async () => { ... });
it('ì•Œë¦¼ ì½ìŒ', async () => { ... });

// âœ… ì¢‹ì€ ì˜ˆ: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
it('ì•Œë¦¼ ìƒì• ì£¼ê¸°: ìƒì„± â†’ ì¡°íšŒ â†’ ì½ìŒ ì²˜ë¦¬ â†’ ì‚­ì œ', async () => {
  // ì‹¤ì œ ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ëŠ” íë¦„ëŒ€ë¡œ í…ŒìŠ¤íŠ¸
});
```

### ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

| ë ˆë²¨ | ëª©í‘œ ì»¤ë²„ë¦¬ì§€ | ìš°ì„ ìˆœìœ„ |
|------|--------------|---------|
| Unit Test | 80-90% | ë†’ìŒ |
| Integration Test | 60-70% | ì¤‘ê°„ |
| E2E Test | ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤ë§Œ | ë‚®ìŒ |

### ğŸš€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ëµ

```bash
# ê°œë°œ ì¤‘: Unit Testë§Œ ë¹ ë¥´ê²Œ ì‹¤í–‰
npm test -- --testPathPattern=spec.ts

# ì»¤ë°‹ ì „: Integration Testê¹Œì§€ ì‹¤í–‰
npm test -- --testPathPattern="(spec|integration.spec).ts"

# CI/CD: ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test

# íŠ¹ì • ëª¨ë“ˆë§Œ í…ŒìŠ¤íŠ¸
npm test -- notifications
```

---

## ê²°ë¡ 

### í•µì‹¬ ì›ì¹™

1. **ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ ë§ì´**: Unit Test 60%
2. **í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì ì ˆíˆ**: Integration Test 30%
3. **ëŠë¦° í…ŒìŠ¤íŠ¸ë¥¼ ì ê²Œ**: E2E Test 10%

### í™©ê¸ˆ ê·œì¹™

- âœ… **Unit Test**: ë¡œì§ ì •í™•ì„±
- âœ… **Integration Test**: í†µí•© ë™ì‘
- âœ… **E2E Test**: ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤

### ê¸°ì–µí•˜ê¸°

> "ê³¼ë„í•œ ê²€ì¦ì€ í…ŒìŠ¤íŠ¸ì˜ ì ì…ë‹ˆë‹¤"

- ê° ë ˆë²¨ì˜ ì±…ì„ì„ ëª…í™•íˆ ë¶„ë¦¬í•˜ì„¸ìš”
- í•µì‹¬ë§Œ ê²€ì¦í•˜ì„¸ìš”
- ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”
- í…ŒìŠ¤íŠ¸ ì½”ë“œë„ í”„ë¡œë•ì…˜ ì½”ë“œë§Œí¼ ì¤‘ìš”í•©ë‹ˆë‹¤

---

## ì°¸ê³  ìë£Œ

- [NestJS Testing Documentation](https://docs.nestjs.com/fundamentals/testing)
- [Jest Documentation](https://jestjs.io/)
- [Test Pyramid - Martin Fowler](https://martinfowler.com/articles/practical-test-pyramid.html)

---

> **ì‘ì„±ì¼**: 2025-11-23
> **ë²„ì „**: 1.0
> **ì‘ì„±ì**: Claude AI Assistant
