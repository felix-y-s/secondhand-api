# Winston ë¡œê±° êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

- **í”„ë¡œì íŠ¸**: ì¤‘ê³ ê±°ë˜ì‚¬ì´íŠ¸ ë°±ì—”ë“œ API
- **ì‘ì„±ì¼**: 2025-10-15
- **ëª©ì **: Winston ë¡œê±° ë„ì… ê°€ì´ë“œ ë° êµ¬í˜„ ë°©ë²•

---

## ğŸ¯ Winston ë¡œê±° ë„ì… í•„ìš”ì„±

### í•µì‹¬ ì´ìœ 

#### 1. ê±°ë˜ ì¶”ì ì„± (Audit Trail) í•„ìˆ˜
ì¤‘ê³ ê±°ë˜ í”Œë«í¼ì˜ ë²•ì  ìš”êµ¬ì‚¬í•­:
- ëª¨ë“  ê±°ë˜ ê³¼ì • ê¸°ë¡ ë³´ê´€
- ë¶„ìŸ í•´ê²°ì„ ìœ„í•œ ì¦ê±° ë³´ì „
- ì „ììƒê±°ë˜ë²• ì¤€ìˆ˜

#### 2. ì»´í”Œë¼ì´ì–¸ìŠ¤ (Compliance)
- **GDPR**: ê°œì¸ì •ë³´ ì²˜ë¦¬ ê¸°ë¡ ë³´ê´€
- **PCI DSS**: ê²°ì œ ë°ì´í„° ì²˜ë¦¬ ë¡œê·¸ ë³´ì•ˆ
- **ê°œì¸ì •ë³´ë³´í˜¸ë²•**: ì ‘ê·¼ ê¸°ë¡ ë° ì²˜ë¦¬ ë‚´ì—­

#### 3. ì‚¬ê¸° íƒì§€ ë° ë³´ì•ˆ
- ì´ìƒ íŒ¨í„´ ê°ì§€ë¥¼ ìœ„í•œ ë¡œê·¸ ë¶„ì„
- ì‹¤ì‹œê°„ ìœ„í˜‘ ëª¨ë‹ˆí„°ë§
- ë³´ì•ˆ ê°ì‚¬ (Security Audit)

#### 4. í”„ë¡œë•ì…˜ ì•ˆì •ì„±
- ì¥ì•  ë°œìƒ ì‹œ ë¹ ë¥¸ ì›ì¸ íŒŒì•…
- ì„±ëŠ¥ ë³‘ëª© ì§€ì  ë¶„ì„
- ì‹œìŠ¤í…œ í—¬ìŠ¤ ëª¨ë‹ˆí„°ë§

---

## ğŸ“Š NestJS ê¸°ë³¸ Logger vs Winston ë¹„êµ

| ê¸°ëŠ¥ | NestJS Logger | Winston |
|------|---------------|---------|
| **íŒŒì¼ ì €ì¥** | âŒ ì½˜ì†”ë§Œ | âœ… íŒŒì¼, ë¡œí…Œì´ì…˜ |
| **ë¡œê·¸ ë ˆë²¨** | âœ… ê¸°ë³¸ ì§€ì› | âœ… ì„¸ë°€í•œ ì œì–´ |
| **JSON í¬ë§·** | âš ï¸ ì œí•œì  | âœ… ì™„ì „í•œ êµ¬ì¡°í™” |
| **ì™¸ë¶€ ì—°ë™** | âŒ | âœ… ELK, CloudWatch, Loggly |
| **ë¡œí…Œì´ì…˜** | âŒ | âœ… ì¼ë³„/í¬ê¸°ë³„ |
| **ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹** | âŒ ìˆ˜ë™ | âœ… ìë™í™” ê°€ëŠ¥ |
| **ì„±ëŠ¥** | âœ… ë¹ ë¦„ | âœ… ë¹„ë™ê¸° ì²˜ë¦¬ |
| **NestJS í†µí•©** | âœ… ì™„ë²½ | âœ… nest-winston |
| **í”„ë¡œë•ì…˜ ê²€ì¦** | âš ï¸ ê¸°ë³¸ | âœ… ì—…ê³„ í‘œì¤€ |

### ê²°ë¡ 
**Winston ë„ì… ì ê·¹ ê¶Œì¥** âœ…

---

## ğŸ”§ êµ¬í˜„ ë‹¨ê³„

### Step 1: íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
# Winston ë° NestJS í†µí•©
pnpm add winston nest-winston

# ë¡œê·¸ ë¡œí…Œì´ì…˜
pnpm add winston-daily-rotate-file

# íƒ€ì… ì •ì˜
pnpm add -D @types/node
```

---

### Step 2: Winston ì„¤ì • ëª¨ë“ˆ ìƒì„±

#### 2.1 ë¡œê±° ì„¤ì • íŒŒì¼

```typescript
// src/config/logger.config.ts
import { WinstonModuleOptions } from 'nest-winston';
import * as winston from 'winston';
import * as DailyRotateFile from 'winston-daily-rotate-file';
import { utilities as nestWinstonModuleUtilities } from 'nest-winston';

/**
 * ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í•¨ìˆ˜
 */
const maskSensitiveData = winston.format((info) => {
  const message = JSON.stringify(info);

  // ë¹„ë°€ë²ˆí˜¸ ë§ˆìŠ¤í‚¹
  info.message = message
    .replace(/"password":\s*"[^"]*"/g, '"password": "****"')
    .replace(/"passwordHash":\s*"[^"]*"/g, '"passwordHash": "****"')
    // ì¹´ë“œ ë²ˆí˜¸ ë§ˆìŠ¤í‚¹
    .replace(/\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}/g, '****-****-****-****')
    // ì´ë©”ì¼ ë¶€ë¶„ ë§ˆìŠ¤í‚¹
    .replace(/([a-zA-Z0-9._-]+)@/g, '***@')
    // ì „í™”ë²ˆí˜¸ ë§ˆìŠ¤í‚¹
    .replace(/\d{3}[-\s]?\d{3,4}[-\s]?\d{4}/g, '***-****-****');

  return info;
});

/**
 * Winston ë¡œê±° ì„¤ì •
 */
export const winstonConfig: WinstonModuleOptions = {
  transports: [
    // ì½˜ì†” ì¶œë ¥ (ê°œë°œ í™˜ê²½)
    new winston.transports.Console({
      level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
      format: winston.format.combine(
        winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
        winston.format.ms(),
        nestWinstonModuleUtilities.format.nestLike('SecondhandAPI', {
          colors: true,
          prettyPrint: true,
        }),
      ),
    }),

    // ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ (í”„ë¡œë•ì…˜)
    new DailyRotateFile({
      level: 'error',
      dirname: 'logs',
      filename: 'error-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      zippedArchive: true,
      maxSize: '20m',
      maxFiles: '14d',
      format: winston.format.combine(
        winston.format.timestamp(),
        maskSensitiveData(),
        winston.format.json(),
      ),
    }),

    // ì „ì²´ ë¡œê·¸ íŒŒì¼ (í”„ë¡œë•ì…˜)
    new DailyRotateFile({
      level: 'info',
      dirname: 'logs',
      filename: 'combined-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      zippedArchive: true,
      maxSize: '20m',
      maxFiles: '14d',
      format: winston.format.combine(
        winston.format.timestamp(),
        maskSensitiveData(),
        winston.format.json(),
      ),
    }),

    // ê±°ë˜ ë¡œê·¸ íŒŒì¼ (ë³„ë„ ë³´ê´€)
    new DailyRotateFile({
      level: 'info',
      dirname: 'logs/transactions',
      filename: 'transaction-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      zippedArchive: true,
      maxSize: '50m',
      maxFiles: '30d', // 30ì¼ ë³´ê´€
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.json(),
      ),
    }),

    // ë””ë²„ê·¸ ë¡œê·¸ (ê°œë°œ í™˜ê²½ë§Œ)
    ...(process.env.NODE_ENV !== 'production'
      ? [
          new DailyRotateFile({
            level: 'debug',
            dirname: 'logs',
            filename: 'debug-%DATE%.log',
            datePattern: 'YYYY-MM-DD',
            maxSize: '20m',
            maxFiles: '3d',
            format: winston.format.combine(
              winston.format.timestamp(),
              winston.format.json(),
            ),
          }),
        ]
      : []),
  ],

  // ì˜ˆì™¸ ë° ê±°ë¶€ëœ í”„ë¡œë¯¸ìŠ¤ ì²˜ë¦¬
  exceptionHandlers: [
    new DailyRotateFile({
      dirname: 'logs',
      filename: 'exceptions-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxSize: '20m',
      maxFiles: '14d',
    }),
  ],

  rejectionHandlers: [
    new DailyRotateFile({
      dirname: 'logs',
      filename: 'rejections-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxSize: '20m',
      maxFiles: '14d',
    }),
  ],
};
```

---

### Step 3: AppModuleì— Winston í†µí•©

```typescript
// src/app.module.ts
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { WinstonModule } from 'nest-winston';
import { winstonConfig } from './config/logger.config';
import databaseConfig from './config/database.config';
import jwtConfig from './config/jwt.config';
import appConfig from './config/app.config';

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      load: [databaseConfig, jwtConfig, appConfig],
    }),

    // Winston ë¡œê±° ê¸€ë¡œë²Œ ëª¨ë“ˆë¡œ ë“±ë¡
    WinstonModule.forRoot(winstonConfig),

    // ë‹¤ë¥¸ ëª¨ë“ˆë“¤...
  ],
})
export class AppModule {}
```

---

### Step 4: main.tsì—ì„œ Winston ë¡œê±° ì ìš©

```typescript
// src/main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe, Logger } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';
import * as compression from 'compression';
import helmet from 'helmet';
import { AllExceptionsFilter } from './common/filters/http-exception.filter';
import { TransformInterceptor } from './common/interceptors/transform.interceptor';
import { LoggingInterceptor } from './common/interceptors/logging.interceptor';
import { setupSwagger } from './config/swagger.config';

async function bootstrap() {
  const app = await NestFactory.create(AppModule, {
    bufferLogs: true, // Winstonì´ ë¡œê·¸ë¥¼ ë²„í¼ë§í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
  });

  // Winston ë¡œê±°ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê±°ë¡œ ì„¤ì •
  app.useLogger(app.get(WINSTON_MODULE_NEST_PROVIDER));

  const configService = app.get(ConfigService);
  const logger = new Logger('Bootstrap');

  // ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
  app.use(helmet());
  app.use(compression());

  // CORS ì„¤ì •
  app.enableCors({
    origin: configService.get<string[]>('app.corsOrigins'),
    credentials: true,
  });

  // ê¸€ë¡œë²Œ í”„ë¦¬í”½ìŠ¤
  app.setGlobalPrefix(configService.get<string>('app.apiPrefix'));

  // ê¸€ë¡œë²Œ íŒŒì´í”„
  app.useGlobalPipes(
    new ValidationPipe({
      whitelist: true,
      forbidNonWhitelisted: true,
      transform: true,
      transformOptions: {
        enableImplicitConversion: true,
      },
    }),
  );

  // ê¸€ë¡œë²Œ í•„í„°
  app.useGlobalFilters(new AllExceptionsFilter());

  // ê¸€ë¡œë²Œ ì¸í„°ì…‰í„°
  app.useGlobalInterceptors(
    new LoggingInterceptor(),
    new TransformInterceptor(),
  );

  // Swagger ì„¤ì •
  setupSwagger(app);

  const port = configService.get<number>('app.port');
  await app.listen(port);

  logger.log(`ğŸš€ Application is running on: http://localhost:${port}`);
  logger.log(`ğŸ“š API Documentation: http://localhost:${port}/api-docs`);
  logger.log(`ğŸŒ Environment: ${configService.get<string>('app.nodeEnv')}`);
}

bootstrap();
```

---

### Step 5: ì„œë¹„ìŠ¤ì—ì„œ Winston ë¡œê±° ì‚¬ìš©

```typescript
// src/modules/users/users.service.ts
import { Injectable, Inject, LoggerService } from '@nestjs/common';
import { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';
import { PrismaService } from '../../prisma/prisma.service';

@Injectable()
export class UsersService {
  constructor(
    @Inject(WINSTON_MODULE_NEST_PROVIDER)
    private readonly logger: LoggerService,
    private readonly prisma: PrismaService,
  ) {}

  async findOne(id: number) {
    this.logger.log(`ì‚¬ìš©ì ì¡°íšŒ ì‹œì‘: userId=${id}`, 'UsersService');

    try {
      const user = await this.prisma.user.findUnique({
        where: { id },
      });

      if (!user) {
        this.logger.warn(`ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: userId=${id}`, 'UsersService');
        return null;
      }

      this.logger.log(
        `ì‚¬ìš©ì ì¡°íšŒ ì™„ë£Œ: userId=${id}, email=${user.email}`,
        'UsersService',
      );

      return user;
    } catch (error) {
      this.logger.error(
        `ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨: userId=${id}, error=${error.message}`,
        error.stack,
        'UsersService',
      );
      throw error;
    }
  }

  async create(data: CreateUserDto) {
    this.logger.log(
      `ì‚¬ìš©ì ìƒì„± ì‹œì‘: email=${data.email}`,
      'UsersService',
    );

    try {
      const user = await this.prisma.user.create({
        data: {
          email: data.email,
          passwordHash: data.password, // ì‹¤ì œë¡œëŠ” í•´ì‹± í•„ìš”
        },
      });

      this.logger.log(
        `ì‚¬ìš©ì ìƒì„± ì™„ë£Œ: userId=${user.id}, email=${user.email}`,
        'UsersService',
      );

      return user;
    } catch (error) {
      this.logger.error(
        `ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨: email=${data.email}, error=${error.message}`,
        error.stack,
        'UsersService',
      );
      throw error;
    }
  }
}
```

---

### Step 6: ê±°ë˜ ì „ìš© ë¡œê±° ì„œë¹„ìŠ¤

```typescript
// src/shared/services/transaction-logger.service.ts
import { Injectable, Inject, LoggerService } from '@nestjs/common';
import { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';

export interface TransactionLog {
  transactionId: string;
  type: 'ORDER' | 'PAYMENT' | 'SHIPMENT' | 'REFUND';
  userId: number;
  orderId?: number;
  amount?: number;
  status: string;
  metadata?: Record<string, any>;
}

@Injectable()
export class TransactionLoggerService {
  constructor(
    @Inject(WINSTON_MODULE_NEST_PROVIDER)
    private readonly logger: LoggerService,
  ) {}

  /**
   * ê±°ë˜ ë¡œê·¸ ê¸°ë¡ (ë³„ë„ íŒŒì¼ì— ì €ì¥)
   */
  logTransaction(log: TransactionLog): void {
    const logMessage = {
      timestamp: new Date().toISOString(),
      ...log,
    };

    // 'transaction' ì»¨í…ìŠ¤íŠ¸ë¡œ ë¡œê¹…í•˜ë©´ ë³„ë„ íŒŒì¼ì— ì €ì¥ë¨
    this.logger.log(
      JSON.stringify(logMessage),
      'TransactionLogger',
    );
  }

  /**
   * ì£¼ë¬¸ ìƒì„± ë¡œê·¸
   */
  logOrderCreated(orderId: number, userId: number, amount: number): void {
    this.logTransaction({
      transactionId: `ORDER-${orderId}-${Date.now()}`,
      type: 'ORDER',
      userId,
      orderId,
      amount,
      status: 'CREATED',
    });
  }

  /**
   * ê²°ì œ ì™„ë£Œ ë¡œê·¸
   */
  logPaymentCompleted(
    orderId: number,
    userId: number,
    amount: number,
    paymentMethod: string,
  ): void {
    this.logTransaction({
      transactionId: `PAY-${orderId}-${Date.now()}`,
      type: 'PAYMENT',
      userId,
      orderId,
      amount,
      status: 'COMPLETED',
      metadata: { paymentMethod },
    });
  }

  /**
   * í™˜ë¶ˆ ë¡œê·¸
   */
  logRefund(
    orderId: number,
    userId: number,
    amount: number,
    reason: string,
  ): void {
    this.logTransaction({
      transactionId: `REFUND-${orderId}-${Date.now()}`,
      type: 'REFUND',
      userId,
      orderId,
      amount,
      status: 'REFUNDED',
      metadata: { reason },
    });
  }
}
```

---

### Step 7: HTTP ìš”ì²­ ë¡œê¹… ì¸í„°ì…‰í„° ì—…ë°ì´íŠ¸

```typescript
// src/common/interceptors/logging.interceptor.ts
import {
  Injectable,
  NestInterceptor,
  ExecutionContext,
  CallHandler,
  Inject,
  LoggerService,
} from '@nestjs/common';
import { Observable } from 'rxjs';
import { tap } from 'rxjs/operators';
import { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';

@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  constructor(
    @Inject(WINSTON_MODULE_NEST_PROVIDER)
    private readonly logger: LoggerService,
  ) {}

  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    const request = context.switchToHttp().getRequest();
    const method = request.method;
    const url = request.url;
    const userId = request.user?.userId || 'anonymous';
    const now = Date.now();

    // ìš”ì²­ ì‹œì‘ ë¡œê·¸
    this.logger.log(
      `ğŸ“¥ [${method}] ${url} - User: ${userId}`,
      'HTTP',
    );

    return next.handle().pipe(
      tap({
        next: () => {
          const response = context.switchToHttp().getResponse();
          const statusCode = response.statusCode;
          const delay = Date.now() - now;

          // ì‘ë‹µ ì„±ê³µ ë¡œê·¸
          this.logger.log(
            `ğŸ“¤ [${method}] ${url} ${statusCode} - ${delay}ms - User: ${userId}`,
            'HTTP',
          );
        },
        error: (error) => {
          const delay = Date.now() - now;

          // ì‘ë‹µ ì—ëŸ¬ ë¡œê·¸
          this.logger.error(
            `âŒ [${method}] ${url} ${error.status || 500} - ${delay}ms - User: ${userId}`,
            error.stack,
            'HTTP',
          );
        },
      }),
    );
  }
}
```

---

## ğŸ“‚ ë¡œê·¸ íŒŒì¼ êµ¬ì¡°

```
logs/
â”œâ”€â”€ combined-2025-10-15.log      # ì „ì²´ ë¡œê·¸ (info ì´ìƒ)
â”œâ”€â”€ error-2025-10-15.log          # ì—ëŸ¬ ë¡œê·¸ë§Œ
â”œâ”€â”€ debug-2025-10-15.log          # ë””ë²„ê·¸ ë¡œê·¸ (ê°œë°œ í™˜ê²½)
â”œâ”€â”€ exceptions-2025-10-15.log     # ì˜ˆì™¸ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì—ëŸ¬
â”œâ”€â”€ rejections-2025-10-15.log     # Promise rejection
â””â”€â”€ transactions/
    â””â”€â”€ transaction-2025-10-15.log # ê±°ë˜ ë¡œê·¸ (ë³„ë„ ë³´ê´€)
```

---

## ğŸ”’ ë³´ì•ˆ ë° ì»´í”Œë¼ì´ì–¸ìŠ¤

### 1. ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹

Winston ì„¤ì •ì— í¬í•¨ëœ `maskSensitiveData` í¬ë§·ìœ¼ë¡œ ìë™ ë§ˆìŠ¤í‚¹:
- ë¹„ë°€ë²ˆí˜¸
- ì¹´ë“œ ë²ˆí˜¸
- ì´ë©”ì¼ (ë¶€ë¶„ ë§ˆìŠ¤í‚¹)
- ì „í™”ë²ˆí˜¸

### 2. ë¡œê·¸ ë³´ê´€ ì •ì±…

| ë¡œê·¸ íƒ€ì… | ë³´ê´€ ê¸°ê°„ | ì´ìœ  |
|-----------|-----------|------|
| ê±°ë˜ ë¡œê·¸ | 30ì¼ | ì „ììƒê±°ë˜ë²• ìš”êµ¬ì‚¬í•­ |
| ì—ëŸ¬ ë¡œê·¸ | 14ì¼ | ì¥ì•  ë¶„ì„ |
| ì „ì²´ ë¡œê·¸ | 14ì¼ | ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ |
| ë””ë²„ê·¸ ë¡œê·¸ | 3ì¼ | ê°œë°œ ë””ë²„ê¹… |

### 3. ì ‘ê·¼ ê¶Œí•œ ì œì–´

```bash
# ë¡œê·¸ íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod 640 logs/*.log
chown appuser:appgroup logs/*.log

# ê±°ë˜ ë¡œê·¸ëŠ” ë” ì—„ê²©í•˜ê²Œ
chmod 600 logs/transactions/*.log
```

---

## ğŸ“Š ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### 1. ë¹„ë™ê¸° íŒŒì¼ ì“°ê¸°
Winstonì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„ë™ê¸°ë¡œ ï¿½ï¿½ï¿½ì¼ì„ ì‘ì„±í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ì— ìµœì†Œ ì˜í–¥

### 2. ë¡œê·¸ ë ˆë²¨ ìµœì í™”

**ê°œë°œ í™˜ê²½:**
```typescript
level: 'debug'  // ëª¨ë“  ë¡œê·¸ ì¶œë ¥
```

**í”„ë¡œë•ì…˜ í™˜ê²½:**
```typescript
level: 'info'   // info ì´ìƒë§Œ ì¶œë ¥ (debug ì œì™¸)
```

### 3. íŒŒì¼ ë¡œí…Œì´ì…˜

- **ì¼ë³„ ë¡œí…Œì´ì…˜**: ë§¤ì¼ ìì •ì— ìƒˆ íŒŒì¼ ìƒì„±
- **í¬ê¸°ë³„ ë¡œí…Œì´ì…˜**: 20MB ì´ˆê³¼ ì‹œ ìƒˆ íŒŒì¼ ìƒì„±
- **ì••ì¶•**: ì˜¤ë˜ëœ ë¡œê·¸ëŠ” gzip ì••ì¶•
- **ìë™ ì‚­ì œ**: ë³´ê´€ ê¸°ê°„ ì´ˆê³¼ ë¡œê·¸ ìë™ ì‚­ì œ

---

## ğŸ”— ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ ì¤€ë¹„

### 1. Elasticsearch ì—°ë™ (í–¥í›„)

```bash
pnpm add winston-elasticsearch
```

```typescript
// winston-elasticsearch transport ì¶”ê°€
import { ElasticsearchTransport } from 'winston-elasticsearch';

new ElasticsearchTransport({
  level: 'info',
  clientOpts: {
    node: 'http://localhost:9200',
  },
  index: 'secondhand-logs',
})
```

### 2. AWS CloudWatch ì—°ë™ (í–¥í›„)

```bash
pnpm add winston-cloudwatch
```

---

## âœ… ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

### 1. ë¡œê·¸ ìƒì„± í™•ì¸

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
pnpm run start:dev

# ë¡œê·¸ ë””ë ‰í† ë¦¬ í™•ì¸
ls -la logs/

# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
tail -f logs/combined-$(date +%Y-%m-%d).log
```

### 2. ë¡œê·¸ í¬ë§· í™•ì¸

```bash
# JSON í¬ë§· í™•ì¸
cat logs/combined-$(date +%Y-%m-%d).log | jq
```

### 3. ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í…ŒìŠ¤íŠ¸

```typescript
// í…ŒìŠ¤íŠ¸ ì½”ë“œ
this.logger.log('User password: mypassword123');
// ì¶œë ¥: User password: ****

this.logger.log('Card: 1234-5678-9012-3456');
// ì¶œë ¥: Card: ****-****-****-****
```

---

## ğŸ“‹ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 (Week 1-2) - ê¸°ë³¸ ì„¤ì •
- [ ] winston, nest-winston íŒ¨í‚¤ì§€ ì„¤ì¹˜
- [ ] winston-daily-rotate-file ì„¤ì¹˜
- [ ] logger.config.ts ì‘ì„±
- [ ] AppModuleì— Winston í†µí•©
- [ ] main.tsì—ì„œ Winston ë¡œê±° ì ìš©
- [ ] ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì •
- [ ] .gitignoreì— logs/ ì¶”ê°€

### Phase 1 (Week 3-4) - ê³ ê¸‰ ê¸°ëŠ¥
- [ ] ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í•¨ìˆ˜ êµ¬í˜„
- [ ] ê±°ë˜ ì „ìš© ë¡œê±° ì„œë¹„ìŠ¤ ì‘ì„±
- [ ] HTTP ìš”ì²­ ë¡œê¹… ì¸í„°ì…‰í„° ì—…ë°ì´íŠ¸
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ ë¡œê¹…
- [ ] ë¡œê·¸ ë¡œí…Œì´ì…˜ í…ŒìŠ¤íŠ¸

### Phase 2-3 - í†µí•© ë° ëª¨ë‹ˆí„°ë§
- [ ] ê° ëª¨ë“ˆì— Winston ë¡œê±° ì ìš©
- [ ] ê±°ë˜ ë¡œê·¸ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
- [ ] Elasticsearch ì—°ë™ (ì„ íƒ)
- [ ] CloudWatch ì—°ë™ (ì„ íƒ)
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ í†µí•©

---

## ğŸš€ ì¦‰ì‹œ ì‹œì‘í•˜ê¸°

### 1ë‹¨ê³„: íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
pnpm add winston nest-winston winston-daily-rotate-file
```

### 2ë‹¨ê³„: ì„¤ì • íŒŒì¼ ë³µì‚¬
ìœ„ì˜ `logger.config.ts` ì½”ë“œë¥¼ `src/config/logger.config.ts`ì— ìƒì„±

### 3ë‹¨ê³„: AppModule ì—…ë°ì´íŠ¸
ìœ„ì˜ `app.module.ts` ì½”ë“œë¡œ Winston ëª¨ë“ˆ ì¶”ê°€

### 4ë‹¨ê³„: main.ts ì—…ë°ì´íŠ¸
`app.useLogger(app.get(WINSTON_MODULE_NEST_PROVIDER))` ì¶”ê°€

### 5ë‹¨ê³„: ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
```bash
mkdir -p logs/transactions
```

### 6ë‹¨ê³„: .gitignore ì—…ë°ì´íŠ¸
```bash
echo "logs/" >> .gitignore
```

### 7ë‹¨ê³„: ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ë° í…ŒìŠ¤íŠ¸
```bash
pnpm run start:dev
```

---

## ğŸ’¡ ëª¨ë²” ì‚¬ë¡€

### 1. ë¡œê·¸ ë ˆë²¨ ì‚¬ìš© ê°€ì´ë“œ

- **error**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜ (ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”)
- **warn**: ì ì¬ì  ë¬¸ì œ (ëª¨ë‹ˆí„°ë§ í•„ìš”)
- **info**: ì¤‘ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë²¤íŠ¸
- **http**: HTTP ìš”ì²­/ì‘ë‹µ
- **debug**: ìƒì„¸í•œ ë””ë²„ê¹… ì •ë³´ (ê°œë°œ í™˜ê²½ë§Œ)

### 2. êµ¬ì¡°í™”ëœ ë¡œê·¸ ë©”ì‹œì§€

```typescript
// âŒ ë‚˜ìœ ì˜ˆ
this.logger.log('User created');

// âœ… ì¢‹ì€ ì˜ˆ
this.logger.log(
  `ì‚¬ìš©ì ìƒì„± ì™„ë£Œ: userId=${user.id}, email=${user.email}`,
  'UsersService',
);
```

### 3. ì—ëŸ¬ ë¡œê¹…

```typescript
try {
  // ì‘ì—… ìˆ˜í–‰
} catch (error) {
  this.logger.error(
    `ì‘ì—… ì‹¤íŒ¨: ${error.message}`,
    error.stack,
    'ServiceName',
  );
  throw error;
}
```

---

## ğŸ“ˆ ë‹¤ìŒ ë‹¨ê³„

1. **Phase 1 ì™„ë£Œ í›„**: ëª¨ë“  ëª¨ë“ˆì— Winston ë¡œê±° ì ìš©
2. **Phase 2**: ê±°ë˜ ë¡œê·¸ ë¶„ì„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
3. **Phase 3**: Elasticsearch + Kibana ì—°ë™
4. **Phase 4**: ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ í†µí•©

---

**ë¬¸ì„œ ë²„ì „**: v1.0
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-15
**ì‘ì„±ì**: ê°œë°œíŒ€
