# Swagger API 문서 가이드

## 📋 개요

NestJS 프로젝트에 Swagger/OpenAPI 문서화를 통합하여 자동 API 문서 생성 시스템을 구축했습니다.

## 🚀 접속 정보

### Swagger UI 접속
```
개발 환경: http://localhost:3000/api-docs
프로덕션: http://your-domain.com/api-docs
```

### API 기본 정보
- **제목**: 중고거래 플랫폼 API
- **버전**: 1.0
- **설명**: 중고거래 플랫폼 백엔드 API 문서

## 📦 설치된 패키지

```json
{
  "dependencies": {
    "@nestjs/swagger": "^11.2.0"
  }
}
```

## ⚙️ Swagger 설정

### main.ts 설정

```typescript
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';

const config = new DocumentBuilder()
  .setTitle('중고거래 플랫폼 API')
  .setDescription('중고거래 플랫폼 백엔드 API 문서')
  .setVersion('1.0')
  .addTag('users', '사용자 관리')
  .addTag('products', '상품 관리')
  .addTag('orders', '주문 관리')
  .addTag('payments', '결제 관리')
  .addTag('chat', '채팅 시스템')
  .addTag('notifications', '알림 서비스')
  .addBearerAuth(
    {
      type: 'http',
      scheme: 'bearer',
      bearerFormat: 'JWT',
      name: 'JWT',
      description: 'JWT 토큰을 입력하세요',
      in: 'header',
    },
    'access-token',
  )
  .build();

const document = SwaggerModule.createDocument(app, config);
SwaggerModule.setup('api-docs', app, document, {
  swaggerOptions: {
    persistAuthorization: true, // 새로고침 시 인증 정보 유지
    tagsSorter: 'alpha', // 태그 알파벳 순 정렬
    operationsSorter: 'alpha', // API 엔드포인트 알파벳 순 정렬
  },
});
```

### 주요 설정 옵션

| 옵션 | 설명 |
|------|------|
| `persistAuthorization` | 새로고침 시 JWT 토큰 유지 |
| `tagsSorter` | 태그 정렬 방식 (alpha/method) |
| `operationsSorter` | API 엔드포인트 정렬 방식 |

## 🏷️ API 태그 구조

현재 정의된 API 태그:

1. **health** - 서버 상태 확인
2. **users** - 사용자 관리
3. **products** - 상품 관리
4. **orders** - 주문 관리
5. **payments** - 결제 관리
6. **chat** - 채팅 시스템
7. **notifications** - 알림 서비스

## 🔧 데코레이터 사용법

### 1. 컨트롤러 레벨

```typescript
import { ApiTags } from '@nestjs/swagger';

@ApiTags('users') // API 태그 지정
@Controller('users')
export class UsersController {}
```

### 2. 엔드포인트 레벨

```typescript
import { ApiOperation, ApiResponse } from '@nestjs/swagger';

@Get('health')
@ApiOperation({
  summary: '서버 상태 확인',
  description: '서버의 현재 상태와 버전 정보를 반환합니다.'
})
@ApiResponse({
  status: 200,
  description: '서버 상태 정보',
  schema: {
    type: 'object',
    properties: {
      status: { type: 'string', example: 'ok' },
      timestamp: { type: 'string', example: '2025-10-16T10:00:00.000Z' },
      version: { type: 'string', example: '1.0.0' }
    }
  }
})
getHealth() {
  return {
    status: 'ok',
    timestamp: new Date().toISOString(),
    version: '1.0.0',
  };
}
```

### 3. DTO 문서화

```typescript
import { ApiProperty } from '@nestjs/swagger';

export class CreateUserDto {
  @ApiProperty({
    description: '사용자 이메일',
    example: 'user@example.com',
  })
  email: string;

  @ApiProperty({
    description: '비밀번호',
    example: 'password123',
    minLength: 8,
  })
  password: string;

  @ApiProperty({
    description: '닉네임',
    example: '홍길동',
    required: false,
  })
  nickname?: string;
}
```

### 4. 인증 토큰 사용

```typescript
import { ApiBearerAuth } from '@nestjs/swagger';

@ApiBearerAuth('access-token')
@UseGuards(JwtAuthGuard)
@Get('profile')
getProfile(@Request() req) {
  return req.user;
}
```

### 5. 에러 응답 문서화

```typescript
@ApiResponse({ status: 200, description: '성공' })
@ApiResponse({ status: 400, description: '잘못된 요청' })
@ApiResponse({ status: 401, description: '인증 실패' })
@ApiResponse({ status: 404, description: '리소스를 찾을 수 없음' })
@ApiResponse({ status: 500, description: '서버 에러' })
```

## 📝 주요 데코레이터

### 컨트롤러 데코레이터
- `@ApiTags()` - API 그룹 태그
- `@ApiBearerAuth()` - JWT 인증 필요

### 엔드포인트 데코레이터
- `@ApiOperation()` - 엔드포인트 설명
- `@ApiResponse()` - 응답 스키마
- `@ApiParam()` - 경로 파라미터
- `@ApiQuery()` - 쿼리 파라미터
- `@ApiBody()` - 요청 바디

### DTO 데코레이터
- `@ApiProperty()` - DTO 속성 정의
- `@ApiPropertyOptional()` - 선택적 속성

## 🎯 실제 사용 예제

### 헬스 체크 엔드포인트

```typescript
@ApiTags('health')
@Controller()
export class AppController {
  @Get()
  @ApiOperation({
    summary: '헬스 체크',
    description: 'API 서버 상태 확인을 위한 헬스 체크 엔드포인트'
  })
  @ApiResponse({
    status: 200,
    description: '서버 정상 작동',
    schema: {
      type: 'string',
      example: 'Hello World!'
    }
  })
  getHello(): string {
    return 'Hello World!';
  }

  @Get('health')
  @ApiOperation({
    summary: '서버 상태 확인',
    description: '서버의 현재 상태와 버전 정보를 반환합니다.'
  })
  @ApiResponse({
    status: 200,
    description: '서버 상태 정보',
    schema: {
      type: 'object',
      properties: {
        status: { type: 'string', example: 'ok' },
        timestamp: { type: 'string', example: '2025-10-16T10:00:00.000Z' },
        version: { type: 'string', example: '1.0.0' }
      }
    }
  })
  getHealth() {
    return {
      status: 'ok',
      timestamp: new Date().toISOString(),
      version: '1.0.0',
    };
  }
}
```

## 🔐 JWT 인증 설정

### 1. Bearer Token 설정

main.ts에서 이미 설정됨:

```typescript
.addBearerAuth(
  {
    type: 'http',
    scheme: 'bearer',
    bearerFormat: 'JWT',
    name: 'JWT',
    description: 'JWT 토큰을 입력하세요',
    in: 'header',
  },
  'access-token',
)
```

### 2. Swagger UI에서 인증

1. Swagger UI 우측 상단 **Authorize** 버튼 클릭
2. `access-token` 섹션에 JWT 토큰 입력
3. **Authorize** 클릭
4. 이후 모든 인증 필요 API에 자동으로 토큰 포함

## 📚 추가 리소스

### NestJS Swagger 공식 문서
- https://docs.nestjs.com/openapi/introduction

### OpenAPI 명세
- https://swagger.io/specification/

## 🛠️ 개발 팁

### 1. 자동 DTO 생성

```bash
# CLI를 통한 DTO 생성
nest g class users/dto/create-user.dto --no-spec
```

### 2. Swagger JSON 다운로드

Swagger 문서를 JSON 형식으로 다운로드:
```
http://localhost:3000/api-docs-json
```

### 3. 프로덕션 환경에서 비활성화

```typescript
// main.ts
if (process.env.NODE_ENV !== 'production') {
  // Swagger 설정
}
```

## ✅ 체크리스트

새로운 API 엔드포인트 추가 시:

- [ ] `@ApiTags()` 태그 지정
- [ ] `@ApiOperation()` 설명 추가
- [ ] `@ApiResponse()` 응답 스키마 정의
- [ ] DTO에 `@ApiProperty()` 추가
- [ ] 인증 필요 시 `@ApiBearerAuth()` 추가
- [ ] 에러 응답 문서화

## 📌 다음 단계

1. **DTO 클래스 생성** - 각 모듈별 요청/응답 DTO
2. **에러 응답 표준화** - 공통 에러 응답 포맷
3. **API 버저닝** - v1, v2 등 버전 관리
4. **예제 데이터** - 실제 사용 가능한 예제 추가
