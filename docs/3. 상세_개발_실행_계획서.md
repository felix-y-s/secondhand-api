# ìƒì„¸ ê°œë°œ ì‹¤í–‰ ê³„íšì„œ: ì¤‘ê³ ê±°ë˜ì‚¬ì´íŠ¸ ë°±ì—”ë“œ API

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

- **í”„ë¡œì íŠ¸**: ì¤‘ê³ ê±°ë˜ì‚¬ì´íŠ¸ ë°±ì—”ë“œ API
- **ë²„ì „**: v1.0
- **ì‘ì„±ì¼**: 2025-10-15
- **ê°œë°œ ê¸°ê°„**: 16ì£¼ (4ê°œì›”)
- **ê°œë°œ ë°©ì‹**: ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ êµ¬ì¶• â†’ ìˆœì°¨ì  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

## ğŸ¯ ê°œë°œ ì „ëµ ê°œìš”

### í•µì‹¬ ì „ëµ
1. **ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ìš°ì„ **: ì¸í”„ë¼, ê³µí†µ ëª¨ë“ˆ, ì„¤ì • ì½”ë“œë¥¼ ë¨¼ì € ì™„ì„±
2. **ìˆœì°¨ì  êµ¬í˜„**: ê° ë„ë©”ì¸ë³„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆœì„œëŒ€ë¡œ êµ¬í˜„
3. **í…ŒìŠ¤íŠ¸ ì£¼ë„**: ê° ë‹¨ê³„ë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ë° ê²€ì¦
4. **ì ì§„ì  í†µí•©**: ì™„ì„±ëœ ëª¨ë“ˆë¶€í„° í†µí•© í…ŒìŠ¤íŠ¸ ì§„í–‰

### ê°œë°œ ìš°ì„ ìˆœìœ„
```
Phase 1: ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ (ì¸í”„ë¼ + ê³µí†µ ëª¨ë“ˆ)
  â†“
Phase 2: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì¸ì¦ â†’ ìƒí’ˆ â†’ ì£¼ë¬¸)
  â†“
Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (ê²€ìƒ‰, ì±„íŒ…, ì•Œë¦¼)
  â†“
Phase 4: ìµœì í™” ë° ë°°í¬
```

---

## ğŸ—ï¸ Phase 1: ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ êµ¬ì¶• (1-4ì£¼)

### Week 1: í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • ë° ì¸í”„ë¼ êµ¬ì„±

#### Day 1-2: íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° Docker í™˜ê²½ êµ¬ì„±

**ëª©í‘œ**: ê°œë°œ í™˜ê²½ ì™„ì „ êµ¬ì¶•

**ì‘ì—… ìˆœì„œ**:
1. **ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜**
   ```bash
   # ë°ì´í„°ë² ì´ìŠ¤ ORM ë° ë“œë¼ì´ë²„
   pnpm add @nestjs/typeorm typeorm pg
   pnpm add @nestjs/mongoose mongoose
   pnpm add @nestjs/redis redis
   pnpm add @prisma/client
   pnpm add -D prisma

   # ì´ë²¤íŠ¸ ì•„í‚¤í…ì²˜ (AMQP ì§ì ‘ ì‚¬ìš©)
   pnpm add amqplib amqp-connection-manager
   pnpm add @nestjs/event-emitter @nestjs/cqrs
   pnpm add -D @types/amqplib
   # ì°¸ê³ : @nestjs/microservicesëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

   # ì¸ì¦/ë³´ì•ˆ
   pnpm add @nestjs/config
   pnpm add @nestjs/jwt @nestjs/passport passport-jwt
   pnpm add @nestjs/throttler helmet bcrypt
   pnpm add class-validator class-transformer
   pnpm add -D @types/bcrypt @types/passport-jwt

   # íŒŒì¼ ì—…ë¡œë“œ
   pnpm add @nestjs/platform-express multer
   pnpm add @aws-sdk/client-s3
   pnpm add -D @types/multer

   # ìœ í‹¸ë¦¬í‹°
   pnpm add @nestjs/axios axios
   pnpm add @nestjs/swagger swagger-ui-express
   pnpm add compression
   pnpm add -D @types/compression

   # ë¡œê¹… (Winston)
   pnpm add winston nest-winston winston-daily-rotate-file
   pnpm add -D @types/node
   ```

2. **Docker Compose íŒŒì¼ ì‘ì„±**
   ```yaml
   # docker-compose.yml
   version: '3.8'

   services:
     # PostgreSQL (ì£¼ ë°ì´í„°ë² ì´ìŠ¤)
     postgres:
       image: postgres:14-alpine
       container_name: secondhand-postgres
       environment:
         POSTGRES_DB: secondhand_db
         POSTGRES_USER: postgres
         POSTGRES_PASSWORD: postgres123
       ports:
         - "5432:5432"
       volumes:
         - postgres_data:/var/lib/postgresql/data
       networks:
         - secondhand-network

     # MongoDB (ë¹„êµ¬ì¡°í™” ë°ì´í„°)
     mongodb:
       image: mongo:6-alpine
       container_name: secondhand-mongodb
       environment:
         MONGO_INITDB_ROOT_USERNAME: mongo
         MONGO_INITDB_ROOT_PASSWORD: mongo123
       ports:
         - "27017:27017"
       volumes:
         - mongodb_data:/data/db
       networks:
         - secondhand-network

     # Redis (ìºì‹± ë° ì„¸ì…˜)
     redis:
       image: redis:7-alpine
       container_name: secondhand-redis
       command: redis-server --requirepass redis123
       ports:
         - "6379:6379"
       volumes:
         - redis_data:/data
       networks:
         - secondhand-network

     # RabbitMQ (ë©”ì‹œì§€ í)
     rabbitmq:
       image: rabbitmq:3.12-management-alpine
       container_name: secondhand-rabbitmq
       environment:
         RABBITMQ_DEFAULT_USER: rabbit
         RABBITMQ_DEFAULT_PASS: rabbit123
       ports:
         - "5672:5672"   # AMQP
         - "15672:15672" # Management UI
       volumes:
         - rabbitmq_data:/var/lib/rabbitmq
       networks:
         - secondhand-network

     # Elasticsearch (ê²€ìƒ‰ ì—”ì§„)
     elasticsearch:
       image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
       container_name: secondhand-elasticsearch
       environment:
         - discovery.type=single-node
         - ES_JAVA_OPTS=-Xms512m -Xmx512m
         - xpack.security.enabled=false
       ports:
         - "9200:9200"
       volumes:
         - elasticsearch_data:/usr/share/elasticsearch/data
       networks:
         - secondhand-network

   networks:
     secondhand-network:
       driver: bridge

   volumes:
     postgres_data:
     mongodb_data:
     redis_data:
     rabbitmq_data:
     elasticsearch_data:
   ```

3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   ```bash
   # .env
   # ì• í”Œë¦¬ì¼€ì´ì…˜
   NODE_ENV=development
   PORT=3000
   API_PREFIX=/api/v1

   # PostgreSQL
   DATABASE_HOST=localhost
   DATABASE_PORT=5432
   DATABASE_USERNAME=postgres
   DATABASE_PASSWORD=postgres123
   DATABASE_NAME=secondhand_db

   # MongoDB
   MONGODB_URI=mongodb://mongo:mongo123@localhost:27017/secondhand_db?authSource=admin

   # Redis
   REDIS_HOST=localhost
   REDIS_PORT=6379
   REDIS_PASSWORD=redis123

   # RabbitMQ
   RABBITMQ_URL=amqp://rabbit:rabbit123@localhost:5672

   # Elasticsearch
   ELASTICSEARCH_NODE=http://localhost:9200

   # JWT
   JWT_SECRET=your-super-secret-jwt-key-change-in-production
   JWT_EXPIRATION=1h
   JWT_REFRESH_SECRET=your-refresh-secret-key
   JWT_REFRESH_EXPIRATION=7d

   # íŒŒì¼ ì—…ë¡œë“œ
   AWS_S3_REGION=ap-northeast-2
   AWS_S3_BUCKET_NAME=secondhand-uploads
   AWS_ACCESS_KEY_ID=your-aws-access-key
   AWS_SECRET_ACCESS_KEY=your-aws-secret-key

   # ì™¸ë¶€ API (ë‚˜ì¤‘ì— ì„¤ì •)
   TOSS_PAYMENTS_SECRET_KEY=
   KAKAO_REST_API_KEY=
   GOOGLE_CLIENT_ID=
   ```

4. **Dockerfile ì‘ì„±**
   ```dockerfile
   # Dockerfile
   FROM node:20-alpine AS builder

   WORKDIR /app

   # ì˜ì¡´ì„± ì„¤ì¹˜
   COPY package.json pnpm-lock.yaml ./
   RUN npm install -g pnpm && pnpm install --frozen-lockfile

   # ì†ŒìŠ¤ ë³µì‚¬ ë° ë¹Œë“œ
   COPY . .
   RUN pnpm run build

   # í”„ë¡œë•ì…˜ ì´ë¯¸ì§€
   FROM node:20-alpine

   WORKDIR /app

   COPY --from=builder /app/dist ./dist
   COPY --from=builder /app/node_modules ./node_modules
   COPY package.json ./

   EXPOSE 3000

   CMD ["node", "dist/main"]
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] Docker Compose ì‹¤í–‰ í™•ì¸: `docker-compose up -d`
- [ ] ëª¨ë“  ì»¨í…Œì´ë„ˆ ì •ìƒ ë™ì‘ í™•ì¸
- [ ] ê° ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] RabbitMQ Management UI ì ‘ì† í™•ì¸ (http://localhost:15672)

---

#### Day 3-5: í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ë° ê³µí†µ ëª¨ë“ˆ ìƒì„±

**ëª©í‘œ**: í‘œì¤€í™”ëœ í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ê³µí†µ ëª¨ë“ˆ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì™„ì„±

**ì‘ì—… ìˆœì„œ**:

1. **í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ìƒì„±**
   ```bash
   # ê³µí†µ ëª¨ë“ˆ
   nest g module common
   nest g module common/guards
   nest g module common/interceptors
   nest g module common/decorators
   nest g module common/pipes
   nest g module common/filters

   # ì„¤ì • ëª¨ë“ˆ
   nest g module config

   # ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ
   nest g module database
   nest g module database/postgresql
   nest g module database/mongodb
   nest g module database/redis

   # ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ
   nest g module events

   # í ì‹œìŠ¤í…œ
   nest g module queues

   # ë³´ì•ˆ ëª¨ë“ˆ
   nest g module security

   # ì™¸ë¶€ ì—°ë™ (ë‚˜ì¤‘ì— êµ¬í˜„)
   nest g module integrations

   # ë„ë©”ì¸ ëª¨ë“ˆ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
   nest g module modules/users
   nest g module modules/auth
   nest g module modules/products
   nest g module modules/orders
   nest g module modules/categories
   ```

2. **ê³µí†µ ì„¤ì • íŒŒì¼ ì‘ì„±**

   **a. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ëª¨ë“ˆ**
   ```typescript
   // src/config/database.config.ts
   import { registerAs } from '@nestjs/config';

   export default registerAs('database', () => ({
     postgresql: {
       host: process.env.DATABASE_HOST || 'localhost',
       port: parseInt(process.env.DATABASE_PORT, 10) || 5432,
       username: process.env.DATABASE_USERNAME || 'postgres',
       password: process.env.DATABASE_PASSWORD || 'postgres123',
       database: process.env.DATABASE_NAME || 'secondhand_db',
     },
     mongodb: {
       uri: process.env.MONGODB_URI || 'mongodb://mongo:mongo123@localhost:27017/secondhand_db?authSource=admin',
     },
     redis: {
       host: process.env.REDIS_HOST || 'localhost',
       port: parseInt(process.env.REDIS_PORT, 10) || 6379,
       password: process.env.REDIS_PASSWORD || 'redis123',
     },
   }));
   ```

   **b. JWT ì„¤ì • ëª¨ë“ˆ**
   ```typescript
   // src/config/jwt.config.ts
   import { registerAs } from '@nestjs/config';

   export default registerAs('jwt', () => ({
     secret: process.env.JWT_SECRET || 'your-secret-key',
     expiresIn: process.env.JWT_EXPIRATION || '1h',
     refreshSecret: process.env.JWT_REFRESH_SECRET || 'your-refresh-secret',
     refreshExpiresIn: process.env.JWT_REFRESH_EXPIRATION || '7d',
   }));
   ```

   **c. ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ëª¨ë“ˆ**
   ```typescript
   // src/config/app.config.ts
   import { registerAs } from '@nestjs/config';

   export default registerAs('app', () => ({
     nodeEnv: process.env.NODE_ENV || 'development',
     port: parseInt(process.env.PORT, 10) || 3000,
     apiPrefix: process.env.API_PREFIX || '/api/v1',
     corsOrigins: process.env.CORS_ORIGINS?.split(',') || ['http://localhost:3000'],
   }));
   ```

3. **ê³µí†µ ì¸í„°ì…‰í„° ì‘ì„±**

   **a. ì‘ë‹µ ë³€í™˜ ì¸í„°ì…‰í„°**
   ```typescript
   // src/common/interceptors/transform.interceptor.ts
   import {
     Injectable,
     NestInterceptor,
     ExecutionContext,
     CallHandler,
   } from '@nestjs/common';
   import { Observable } from 'rxjs';
   import { map } from 'rxjs/operators';

   export interface Response<T> {
     success: boolean;
     statusCode: number;
     message: string;
     data: T;
     timestamp: string;
   }

   @Injectable()
   export class TransformInterceptor<T>
     implements NestInterceptor<T, Response<T>>
   {
     intercept(
       context: ExecutionContext,
       next: CallHandler,
     ): Observable<Response<T>> {
       return next.handle().pipe(
         map((data) => ({
           success: true,
           statusCode: context.switchToHttp().getResponse().statusCode,
           message: 'Request successful',
           data,
           timestamp: new Date().toISOString(),
         })),
       );
     }
   }
   ```

   **b. ë¡œê¹… ì¸í„°ì…‰í„°**
   ```typescript
   // src/common/interceptors/logging.interceptor.ts
   import {
     Injectable,
     NestInterceptor,
     ExecutionContext,
     CallHandler,
     Logger,
   } from '@nestjs/common';
   import { Observable } from 'rxjs';
   import { tap } from 'rxjs/operators';

   @Injectable()
   export class LoggingInterceptor implements NestInterceptor {
     private readonly logger = new Logger(LoggingInterceptor.name);

     intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
       const request = context.switchToHttp().getRequest();
       const method = request.method;
       const url = request.url;
       const now = Date.now();

       return next.handle().pipe(
         tap(() => {
           const response = context.switchToHttp().getResponse();
           const statusCode = response.statusCode;
           const delay = Date.now() - now;

           this.logger.log(
             `${method} ${url} ${statusCode} - ${delay}ms`,
           );
         }),
       );
     }
   }
   ```

4. **ê³µí†µ í•„í„° ì‘ì„±**

   **ì˜ˆì™¸ í•„í„°**
   ```typescript
   // src/common/filters/http-exception.filter.ts
   import {
     ExceptionFilter,
     Catch,
     ArgumentsHost,
     HttpException,
     HttpStatus,
     Logger,
   } from '@nestjs/common';
   import { Request, Response } from 'express';

   @Catch()
   export class AllExceptionsFilter implements ExceptionFilter {
     private readonly logger = new Logger(AllExceptionsFilter.name);

     catch(exception: unknown, host: ArgumentsHost) {
       const ctx = host.switchToHttp();
       const response = ctx.getResponse<Response>();
       const request = ctx.getRequest<Request>();

       const status =
         exception instanceof HttpException
           ? exception.getStatus()
           : HttpStatus.INTERNAL_SERVER_ERROR;

       const message =
         exception instanceof HttpException
           ? exception.getResponse()
           : 'Internal server error';

       this.logger.error(
         `HTTP Status: ${status} Error Message: ${JSON.stringify(message)}`,
         exception instanceof Error ? exception.stack : '',
       );

       response.status(status).json({
         success: false,
         statusCode: status,
         timestamp: new Date().toISOString(),
         path: request.url,
         message: typeof message === 'string' ? message : (message as any).message,
       });
     }
   }
   ```

5. **ê³µí†µ íŒŒì´í”„ ì‘ì„±**

   **ê²€ì¦ íŒŒì´í”„ ì„¤ì •**
   ```typescript
   // src/common/pipes/validation.pipe.ts
   import { ValidationPipe } from '@nestjs/common';

   export const validationPipeConfig = new ValidationPipe({
     whitelist: true, // DTOì— ì—†ëŠ” ì†ì„± ì œê±°
     forbidNonWhitelisted: true, // DTOì— ì—†ëŠ” ì†ì„± ìˆìœ¼ë©´ ì—ëŸ¬
     transform: true, // íƒ€ì… ìë™ ë³€í™˜
     transformOptions: {
       enableImplicitConversion: true,
     },
   });
   ```

6. **ê³µí†µ ë°ì½”ë ˆì´í„° ì‘ì„±**

   **ì‚¬ìš©ì ì •ë³´ ë°ì½”ë ˆì´í„°**
   ```typescript
   // src/common/decorators/user.decorator.ts
   import { createParamDecorator, ExecutionContext } from '@nestjs/common';

   export const CurrentUser = createParamDecorator(
     (data: string, ctx: ExecutionContext) => {
       const request = ctx.switchToHttp().getRequest();
       const user = request.user;

       return data ? user?.[data] : user;
     },
   );
   ```

   **ê³µê°œ API ë°ì½”ë ˆì´í„°**
   ```typescript
   // src/common/decorators/public.decorator.ts
   import { SetMetadata } from '@nestjs/common';

   export const IS_PUBLIC_KEY = 'isPublic';
   export const Public = () => SetMetadata(IS_PUBLIC_KEY, true);
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] í´ë” êµ¬ì¡° ìƒì„± ì™„ë£Œ
- [ ] ê³µí†µ ëª¨ë“ˆ íŒŒì¼ ìƒì„± ì™„ë£Œ
- [ ] ì„¤ì • íŒŒì¼ ì‘ì„± ë° í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ í™•ì¸
- [ ] ì¸í„°ì…‰í„°, í•„í„°, íŒŒì´í”„ ì‘ì„± ì™„ë£Œ

---

### Week 2: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ORM ì„¤ì •

#### Day 6-8: Prisma ë° TypeORM ì„¤ì •

**ëª©í‘œ**: PostgreSQL Prisma ORM ì„¤ì • ì™„ë£Œ

**ì‘ì—… ìˆœì„œ**:

1. **Prisma ì´ˆê¸°í™” ë° ìŠ¤í‚¤ë§ˆ ì‘ì„±**
   ```bash
   # Prisma ì´ˆê¸°í™”
   npx prisma init
   ```

2. **Prisma ìŠ¤í‚¤ë§ˆ ì‘ì„± (ê¸°ë³¸ ì—”í‹°í‹°)**
   ```prisma
   // prisma/schema.prisma
   generator client {
     provider = "prisma-client-js"
   }

   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }

   // ì‚¬ìš©ì í…Œì´ë¸”
   model User {
     id              Int       @id @default(autoincrement())
     email           String    @unique @db.VarChar(255)
     passwordHash    String    @map("password_hash") @db.VarChar(255)
     phone           String?   @db.VarChar(20)
     emailVerified   Boolean   @default(false) @map("email_verified")
     phoneVerified   Boolean   @default(false) @map("phone_verified")
     status          UserStatus @default(ACTIVE)
     createdAt       DateTime  @default(now()) @map("created_at")
     updatedAt       DateTime  @updatedAt @map("updated_at")

     // ê´€ê³„
     userRoles       UserRole[]
     products        Product[]
     ordersAsBuyer   Order[]   @relation("BuyerOrders")
     ordersAsSeller  Order[]   @relation("SellerOrders")
     reviews         Review[]

     @@map("users")
   }

   enum UserStatus {
     ACTIVE
     INACTIVE
     SUSPENDED
     DELETED
   }

   // ì—­í•  í…Œì´ë¸”
   model Role {
     id          Int       @id @default(autoincrement())
     name        String    @unique @db.VarChar(50)
     description String?   @db.Text
     createdAt   DateTime  @default(now()) @map("created_at")

     // ê´€ê³„
     userRoles   UserRole[]

     @@map("roles")
   }

   // ì‚¬ìš©ì-ì—­í•  ì¤‘ê°„ í…Œì´ë¸”
   model UserRole {
     userId    Int
     roleId    Int
     createdAt DateTime @default(now()) @map("created_at")

     user User @relation(fields: [userId], references: [id], onDelete: Cascade)
     role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

     @@id([userId, roleId])
     @@map("user_roles")
   }

   // ì¹´í…Œê³ ë¦¬ í…Œì´ë¸” (ê³„ì¸µ êµ¬ì¡°)
   model Category {
     id        Int       @id @default(autoincrement())
     name      String    @db.VarChar(100)
     parentId  Int?      @map("parent_id")
     level     Int
     path      String?   @db.VarChar(500)
     createdAt DateTime  @default(now()) @map("created_at")
     updatedAt DateTime  @updatedAt @map("updated_at")

     // ê´€ê³„
     parent    Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
     children  Category[] @relation("CategoryHierarchy")
     products  Product[]

     @@map("categories")
   }

   // ìƒí’ˆ í…Œì´ë¸” (ê¸°ë³¸ ì •ë³´ë§Œ)
   model Product {
     id            Int           @id @default(autoincrement())
     sellerId      Int           @map("seller_id")
     categoryId    Int           @map("category_id")
     title         String        @db.VarChar(255)
     price         Decimal       @db.Decimal(10, 2)
     status        ProductStatus @default(ACTIVE)
     stockQuantity Int           @default(1) @map("stock_quantity")
     viewCount     Int           @default(0) @map("view_count")
     likeCount     Int           @default(0) @map("like_count")
     createdAt     DateTime      @default(now()) @map("created_at")
     updatedAt     DateTime      @updatedAt @map("updated_at")

     // ê´€ê³„
     seller     User        @relation(fields: [sellerId], references: [id])
     category   Category    @relation(fields: [categoryId], references: [id])
     orderItems OrderItem[]

     @@index([sellerId])
     @@index([categoryId])
     @@index([status])
     @@map("products")
   }

   enum ProductStatus {
     ACTIVE
     RESERVED
     SOLD_OUT
     DELETED
   }

   // ì£¼ë¬¸ í…Œì´ë¸”
   model Order {
     id          Int         @id @default(autoincrement())
     buyerId     Int         @map("buyer_id")
     sellerId    Int         @map("seller_id")
     totalAmount Decimal     @map("total_amount") @db.Decimal(10, 2)
     status      OrderStatus @default(PENDING)
     createdAt   DateTime    @default(now()) @map("created_at")
     updatedAt   DateTime    @updatedAt @map("updated_at")

     // ê´€ê³„
     buyer      User        @relation("BuyerOrders", fields: [buyerId], references: [id])
     seller     User        @relation("SellerOrders", fields: [sellerId], references: [id])
     orderItems OrderItem[]
     payment    Payment?

     @@index([buyerId])
     @@index([sellerId])
     @@index([status])
     @@map("orders")
   }

   enum OrderStatus {
     PENDING
     PAID
     PROCESSING
     SHIPPED
     DELIVERED
     CANCELLED
     REFUNDED
   }

   // ì£¼ë¬¸ ì•„ì´í…œ í…Œì´ë¸”
   model OrderItem {
     id        Int     @id @default(autoincrement())
     orderId   Int     @map("order_id")
     productId Int     @map("product_id")
     quantity  Int
     unitPrice Decimal @map("unit_price") @db.Decimal(10, 2)

     // ê´€ê³„
     order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
     product Product @relation(fields: [productId], references: [id])

     @@index([orderId])
     @@index([productId])
     @@map("order_items")
   }

   // ê²°ì œ í…Œì´ë¸”
   model Payment {
     id            Int           @id @default(autoincrement())
     orderId       Int           @unique @map("order_id")
     paymentMethod String        @map("payment_method") @db.VarChar(50)
     amount        Decimal       @db.Decimal(10, 2)
     status        PaymentStatus @default(PENDING)
     transactionId String?       @map("transaction_id") @db.VarChar(255)
     paidAt        DateTime?     @map("paid_at")
     createdAt     DateTime      @default(now()) @map("created_at")

     // ê´€ê³„
     order Order @relation(fields: [orderId], references: [id])

     @@index([orderId])
     @@index([transactionId])
     @@map("payments")
   }

   enum PaymentStatus {
     PENDING
     PAID
     FAILED
     CANCELLED
     REFUNDED
   }

   // ë¦¬ë·° í…Œì´ë¸”
   model Review {
     id         Int      @id @default(autoincrement())
     reviewerId Int      @map("reviewer_id")
     revieweeId Int      @map("reviewee_id")
     orderId    Int      @map("order_id")
     rating     Int      @db.SmallInt
     comment    String?  @db.Text
     createdAt  DateTime @default(now()) @map("created_at")

     // ê´€ê³„
     reviewer User @relation(fields: [reviewerId], references: [id])

     @@index([reviewerId])
     @@index([revieweeId])
     @@map("reviews")
   }
   ```

3. **Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**
   ```bash
   # DATABASE_URL ì„¤ì •
   echo "DATABASE_URL=postgresql://postgres:postgres123@localhost:5432/secondhand_db" >> .env

   # ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì‹¤í–‰
   npx prisma migrate dev --name init

   # Prisma Client ìƒì„±
   npx prisma generate
   ```

4. **Prisma ëª¨ë“ˆ ìƒì„±**
   ```typescript
   // src/prisma/prisma.module.ts
   import { Module, Global } from '@nestjs/common';
   import { PrismaService } from './prisma.service';

   @Global()
   @Module({
     providers: [PrismaService],
     exports: [PrismaService],
   })
   export class PrismaModule {}
   ```

   ```typescript
   // src/prisma/prisma.service.ts
   import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';
   import { PrismaClient } from '@prisma/client';

   @Injectable()
   export class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {
     private readonly logger = new Logger(PrismaService.name);

     async onModuleInit() {
       await this.$connect();
       this.logger.log('PostgreSQL database connected');
     }

     async onModuleDestroy() {
       await this.$disconnect();
       this.logger.log('PostgreSQL database disconnected');
     }
   }
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] Prisma ìŠ¤í‚¤ë§ˆ ì‘ì„± ì™„ë£Œ
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì„±ê³µ
- [ ] Prisma Client ìƒì„± í™•ì¸
- [ ] PrismaService ëª¨ë“ˆ ìƒì„± ë° í…ŒìŠ¤íŠ¸

---

#### Day 9-10: MongoDB ë° Redis ì—°ê²° ì„¤ì •

**ëª©í‘œ**: MongoDB, Redis ì—°ê²° ë° ëª¨ë“ˆ ì„¤ì • ì™„ë£Œ

**ì‘ì—… ìˆœì„œ**:

1. **MongoDB ìŠ¤í‚¤ë§ˆ ì •ì˜**
   ```typescript
   // src/database/mongodb/schemas/product-detail.schema.ts
   import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
   import { Document } from 'mongoose';

   @Schema({ collection: 'product_details', timestamps: true })
   export class ProductDetail extends Document {
     @Prop({ required: true, unique: true })
     productId: number;

     @Prop({ required: true })
     description: string;

     @Prop({ type: [{ url: String, alt: String, order: Number }] })
     images: { url: string; alt: string; order: number }[];

     @Prop({
       type: {
         brand: String,
         condition: String,
         location: {
           city: String,
           district: String,
           coordinates: [Number],
         },
       },
     })
     specifications: {
       brand?: string;
       condition?: string;
       location?: {
         city: string;
         district: string;
         coordinates: [number, number];
       };
     };

     @Prop({ type: { views: Number, likes: Number, tags: [String] }, default: {} })
     metadata: {
       views: number;
       likes: number;
       tags: string[];
     };
   }

   export const ProductDetailSchema = SchemaFactory.createForClass(ProductDetail);
   ```

   ```typescript
   // src/database/mongodb/schemas/message.schema.ts
   import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
   import { Document } from 'mongoose';

   @Schema({ collection: 'messages', timestamps: true })
   export class Message extends Document {
     @Prop({ required: true })
     conversationId: string;

     @Prop({ required: true })
     senderId: number;

     @Prop({ required: true })
     receiverId: number;

     @Prop({ required: true })
     message: string;

     @Prop({ enum: ['text', 'image', 'system'], default: 'text' })
     messageType: string;

     @Prop()
     readAt?: Date;
   }

   export const MessageSchema = SchemaFactory.createForClass(Message);
   ```

2. **MongoDB ëª¨ë“ˆ ì„¤ì •**
   ```typescript
   // src/database/mongodb/mongodb.module.ts
   import { Module } from '@nestjs/common';
   import { MongooseModule } from '@nestjs/mongoose';
   import { ConfigService } from '@nestjs/config';

   @Module({
     imports: [
       MongooseModule.forRootAsync({
         inject: [ConfigService],
         useFactory: (configService: ConfigService) => ({
           uri: configService.get<string>('database.mongodb.uri'),
         }),
       }),
     ],
   })
   export class MongodbModule {}
   ```

3. **Redis ëª¨ë“ˆ ì„¤ì •**
   ```typescript
   // src/database/redis/redis.module.ts
   import { Module } from '@nestjs/common';
   import { RedisModule as NestRedisModule } from '@nestjs/redis';
   import { ConfigService } from '@nestjs/config';

   @Module({
     imports: [
       NestRedisModule.forRootAsync({
         inject: [ConfigService],
         useFactory: (configService: ConfigService) => ({
           config: {
             host: configService.get<string>('database.redis.host'),
             port: configService.get<number>('database.redis.port'),
             password: configService.get<string>('database.redis.password'),
           },
         }),
       }),
     ],
   })
   export class RedisConfigModule {}
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] MongoDB ìŠ¤í‚¤ë§ˆ ì •ì˜ ì™„ë£Œ
- [ ] MongoDB ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] Redis ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] ê° ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ app.moduleì— ë“±ë¡

---

### Week 3: ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ë° ê³µí†µ ìœ í‹¸ë¦¬í‹°

#### Day 11-13: RabbitMQ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶• (AMQP ì§ì ‘ ì‚¬ìš©)

**ëª©í‘œ**: amqplibë¥¼ ì‚¬ìš©í•œ í”„ë¡œë•ì…˜ê¸‰ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•

> **ì°¸ê³ **: ìƒì„¸ ë‚´ìš©ì€ ë‹¤ìŒ ë¬¸ì„œ ì°¸ì¡°
> - [5. RabbitMQ_êµ¬í˜„_ë°©ì‹_ë¹„êµ_ë¶„ì„.md](5. RabbitMQ_êµ¬í˜„_ë°©ì‹_ë¹„êµ_ë¶„ì„.md)
> - [6. AMQP_ì§ì ‘_êµ¬í˜„_ê°€ì´ë“œ.md](6. AMQP_ì§ì ‘_êµ¬í˜„_ê°€ì´ë“œ.md)

**ì‘ì—… ìˆœì„œ**:

1. **RabbitMQ ì—°ê²° ê´€ë¦¬ ì„œë¹„ìŠ¤**
   ```typescript
   // src/rabbitmq/rabbitmq-connection.service.ts
   import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';
   import { ConfigService } from '@nestjs/config';
   import * as amqp from 'amqp-connection-manager';
   import { ChannelWrapper } from 'amqp-connection-manager';
   import { ConfirmChannel } from 'amqplib';

   @Injectable()
   export class RabbitMQConnectionService implements OnModuleInit, OnModuleDestroy {
     private readonly logger = new Logger(RabbitMQConnectionService.name);
     private connection: amqp.AmqpConnectionManager;
     private channelWrapper: ChannelWrapper;

     constructor(private configService: ConfigService) {}

     async onModuleInit() {
       await this.connect();
     }

     async onModuleDestroy() {
       await this.disconnect();
     }

     private async connect(): Promise<void> {
       const url = this.configService.get<string>('RABBITMQ_URL') || 'amqp://localhost';

       this.logger.log(`RabbitMQ ì—°ê²° ì‹œì‘: ${url}`);

       // ìë™ ì¬ì—°ê²° ì§€ì›
       this.connection = amqp.connect([url], {
         heartbeatIntervalInSeconds: 30,
         reconnectTimeInSeconds: 1,
       });

       // ì—°ê²° ì´ë²¤íŠ¸
       this.connection.on('connect', () => {
         this.logger.log('âœ… RabbitMQ ì—°ê²° ì„±ê³µ');
       });

       this.connection.on('disconnect', (err) => {
         this.logger.error('âŒ RabbitMQ ì—°ê²° ëŠê¹€', err.err);
       });

       // ì±„ë„ ìƒì„±
       this.channelWrapper = this.connection.createChannel({
         json: false,
         setup: async (channel: ConfirmChannel) => {
           await this.setupInfrastructure(channel);
         },
       });

       await this.channelWrapper.waitForConnect();
       this.logger.log('âœ… RabbitMQ ì´ˆê¸°í™” ì™„ë£Œ');
     }

     private async setupInfrastructure(channel: ConfirmChannel): Promise<void> {
       // Exchange ì„¤ì •
       await channel.assertExchange('events', 'topic', { durable: true });
       await channel.assertExchange('commands', 'direct', { durable: true });
       await channel.assertExchange('events-dlx', 'topic', { durable: true });

       // ì£¼ë¬¸ í ì„¤ì •
       await channel.assertQueue('orders-queue', {
         durable: true,
         deadLetterExchange: 'events-dlx',
         deadLetterRoutingKey: 'orders.failed',
       });
       await channel.bindQueue('orders-queue', 'events', 'order.*');

       // ì£¼ë¬¸ DLQ
       await channel.assertQueue('orders-dlq', { durable: true });
       await channel.bindQueue('orders-dlq', 'events-dlx', 'orders.failed');

       // ê²°ì œ í ì„¤ì •
       await channel.assertQueue('payments-queue', {
         durable: true,
         deadLetterExchange: 'events-dlx',
         deadLetterRoutingKey: 'payments.failed',
       });
       await channel.bindQueue('payments-queue', 'events', 'payment.*');

       // ì•Œë¦¼ í (ìš°ì„ ìˆœìœ„)
       await channel.assertQueue('notifications-queue', {
         durable: true,
         maxPriority: 10,
       });
       await channel.bindQueue('notifications-queue', 'events', 'notification.*');

       this.logger.log('âœ… RabbitMQ ì¸í”„ë¼ ì„¤ì • ì™„ë£Œ');
     }

     private async disconnect(): Promise<void> {
       if (this.channelWrapper) {
         await this.channelWrapper.close();
       }
       if (this.connection) {
         await this.connection.close();
       }
       this.logger.log('âœ… RabbitMQ ì—°ê²° ì¢…ë£Œ');
     }

     getChannelWrapper(): ChannelWrapper {
       return this.channelWrapper;
     }

     isConnected(): boolean {
       return this.connection?.isConnected() || false;
     }
   }
   ```

2. **ì´ë²¤íŠ¸ íƒ€ì… ì •ì˜**
   ```typescript
   // src/events/types/event.types.ts
   export enum EventType {
     USER_REGISTERED = 'user.registered',
     USER_VERIFIED = 'user.verified',
     PRODUCT_CREATED = 'product.created',
     PRODUCT_UPDATED = 'product.updated',
     ORDER_CREATED = 'order.created',
     ORDER_PAID = 'order.paid',
     PAYMENT_COMPLETED = 'payment.completed',
   }

   export interface BaseEvent {
     eventId: string;
     eventType: EventType;
     timestamp: Date;
     userId?: number;
   }

   export interface UserRegisteredEvent extends BaseEvent {
     eventType: EventType.USER_REGISTERED;
     data: {
       userId: number;
       email: string;
     };
   }

   export interface ProductCreatedEvent extends BaseEvent {
     eventType: EventType.PRODUCT_CREATED;
     data: {
       productId: number;
       sellerId: number;
       title: string;
       price: number;
     };
   }

   export interface OrderCreatedEvent extends BaseEvent {
     eventType: EventType.ORDER_CREATED;
     data: {
       orderId: number;
       buyerId: number;
       sellerId: number;
       totalAmount: number;
     };
   }
   ```

3. **ì´ë²¤íŠ¸ ë°œí–‰ì ì„œë¹„ìŠ¤**
   ```typescript
   // src/events/publishers/event-publisher.service.ts
   import { Injectable, Inject, Logger } from '@nestjs/common';
   import { ClientProxy } from '@nestjs/microservices';
   import { EventEmitter2 } from '@nestjs/event-emitter';
   import { BaseEvent } from '../types/event.types';

   @Injectable()
   export class EventPublisherService {
     private readonly logger = new Logger(EventPublisherService.name);

     constructor(
       @Inject('RABBITMQ_SERVICE') private rabbitClient: ClientProxy,
       private eventEmitter: EventEmitter2,
     ) {}

     /**
      * ë¡œì»¬ ì´ë²¤íŠ¸ ë°œí–‰ (ê°™ì€ í”„ë¡œì„¸ìŠ¤ ë‚´)
      */
     emitLocal<T extends BaseEvent>(event: T): void {
       this.logger.log(`Emitting local event: ${event.eventType}`);
       this.eventEmitter.emit(event.eventType, event);
     }

     /**
      * ë¶„ì‚° ì´ë²¤íŠ¸ ë°œí–‰ (RabbitMQë¥¼ í†µí•œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¡œ)
      */
     async emitDistributed<T extends BaseEvent>(event: T): Promise<void> {
       this.logger.log(`Emitting distributed event: ${event.eventType}`);
       await this.rabbitClient.emit(event.eventType, event).toPromise();
     }

     /**
      * ë¡œì»¬ + ë¶„ì‚° ë™ì‹œ ë°œí–‰
      */
     async emitAll<T extends BaseEvent>(event: T): Promise<void> {
       this.emitLocal(event);
       await this.emitDistributed(event);
     }
   }
   ```

4. **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë² ì´ìŠ¤ í´ë˜ìŠ¤**
   ```typescript
   // src/events/handlers/base-event.handler.ts
   import { Logger } from '@nestjs/common';
   import { BaseEvent } from '../types/event.types';

   export abstract class BaseEventHandler<T extends BaseEvent> {
     protected readonly logger: Logger;

     constructor(handlerName: string) {
       this.logger = new Logger(handlerName);
     }

     abstract handle(event: T): Promise<void>;

     protected logEvent(event: T): void {
       this.logger.log(
         `Handling event: ${event.eventType} | EventId: ${event.eventId}`,
       );
     }
   }
   ```

2. **Producer ë° Consumer ì„œë¹„ìŠ¤ êµ¬í˜„**
   - Producer: ë©”ì‹œì§€ ë°œí–‰ ì„œë¹„ìŠ¤
   - Consumer: ë©”ì‹œì§€ ì†Œë¹„ ë° ì²˜ë¦¬
   - Dead Letter Queue ì²˜ë¦¬ ë¡œì§
   - ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜

3. **RabbitMQ ëª¨ë“ˆ í†µí•©**
   ```typescript
   // src/rabbitmq/rabbitmq.module.ts
   @Global()
   @Module({
     providers: [
       RabbitMQConnectionService,
       RabbitMQProducerService,
       RabbitMQConsumerService,
     ],
     exports: [
       RabbitMQConnectionService,
       RabbitMQProducerService,
       RabbitMQConsumerService,
     ],
   })
   export class RabbitMQModule {}
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] RabbitMQ ì—°ê²° ë° ìë™ ì¬ì—°ê²° í™•ì¸
- [ ] Exchange, Queue, Binding ìƒì„± í™•ì¸
- [ ] ë©”ì‹œì§€ ë°œí–‰/ì†Œë¹„ í…ŒìŠ¤íŠ¸
- [ ] Dead Letter Queue ë™ì‘ í™•ì¸
- [ ] ìš°ì„ ìˆœìœ„ í í…ŒìŠ¤íŠ¸
- [ ] RabbitMQ Management UIì—ì„œ ëª¨ë‹ˆí„°ë§

---

#### Day 14-15: Winston ë¡œê±° ì„¤ì • ë° ê³µí†µ ìœ í‹¸ë¦¬í‹°

**ëª©í‘œ**: Winston ë¡œê±° êµ¬ì¶• ë° ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±

**ì‘ì—… ìˆœì„œ**:

1. **Winston ë¡œê±° ì„¤ì •** â­ ìš°ì„ ìˆœìœ„ ë†’ìŒ

   > **ì°¸ê³ **: ìƒì„¸ ë‚´ìš©ì€ [docs/4. Winston_ë¡œê±°_êµ¬í˜„_ê°€ì´ë“œ.md](4. Winston_ë¡œê±°_êµ¬í˜„_ê°€ì´ë“œ.md) ì°¸ì¡°

   ```typescript
   // src/config/logger.config.ts
   import { WinstonModuleOptions } from 'nest-winston';
   import * as winston from 'winston';
   import * as DailyRotateFile from 'winston-daily-rotate-file';
   import { utilities as nestWinstonModuleUtilities } from 'nest-winston';

   /**
    * ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í•¨ìˆ˜
    */
   const maskSensitiveData = winston.format((info) => {
     const message = JSON.stringify(info);

     info.message = message
       .replace(/"password":\s*"[^"]*"/g, '"password": "****"')
       .replace(/"passwordHash":\s*"[^"]*"/g, '"passwordHash": "****"')
       .replace(/\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}/g, '****-****-****-****')
       .replace(/([a-zA-Z0-9._-]+)@/g, '***@')
       .replace(/\d{3}[-\s]?\d{3,4}[-\s]?\d{4}/g, '***-****-****');

     return info;
   });

   /**
    * Winston ë¡œê±° ì„¤ì •
    */
   export const winstonConfig: WinstonModuleOptions = {
     transports: [
       // ì½˜ì†” ì¶œë ¥
       new winston.transports.Console({
         level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
         format: winston.format.combine(
           winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
           winston.format.ms(),
           nestWinstonModuleUtilities.format.nestLike('SecondhandAPI', {
             colors: true,
             prettyPrint: true,
           }),
         ),
       }),

       // ì—ëŸ¬ ë¡œê·¸ íŒŒì¼
       new DailyRotateFile({
         level: 'error',
         dirname: 'logs',
         filename: 'error-%DATE%.log',
         datePattern: 'YYYY-MM-DD',
         zippedArchive: true,
         maxSize: '20m',
         maxFiles: '14d',
         format: winston.format.combine(
           winston.format.timestamp(),
           maskSensitiveData(),
           winston.format.json(),
         ),
       }),

       // ì „ì²´ ë¡œê·¸ íŒŒì¼
       new DailyRotateFile({
         level: 'info',
         dirname: 'logs',
         filename: 'combined-%DATE%.log',
         datePattern: 'YYYY-MM-DD',
         zippedArchive: true,
         maxSize: '20m',
         maxFiles: '14d',
         format: winston.format.combine(
           winston.format.timestamp(),
           maskSensitiveData(),
           winston.format.json(),
         ),
       }),

       // ê±°ë˜ ë¡œê·¸ íŒŒì¼ (ë³„ë„ ë³´ê´€)
       new DailyRotateFile({
         level: 'info',
         dirname: 'logs/transactions',
         filename: 'transaction-%DATE%.log',
         datePattern: 'YYYY-MM-DD',
         zippedArchive: true,
         maxSize: '50m',
         maxFiles: '30d',
         format: winston.format.combine(
           winston.format.timestamp(),
           winston.format.json(),
         ),
       }),
     ],

     exceptionHandlers: [
       new DailyRotateFile({
         dirname: 'logs',
         filename: 'exceptions-%DATE%.log',
         datePattern: 'YYYY-MM-DD',
         maxSize: '20m',
         maxFiles: '14d',
       }),
     ],

     rejectionHandlers: [
       new DailyRotateFile({
         dirname: 'logs',
         filename: 'rejections-%DATE%.log',
         datePattern: 'YYYY-MM-DD',
         maxSize: '20m',
         maxFiles: '14d',
       }),
     ],
   };
   ```

   **AppModuleì— Winston í†µí•©**
   ```typescript
   // src/app.module.ts
   import { WinstonModule } from 'nest-winston';
   import { winstonConfig } from './config/logger.config';

   @Module({
     imports: [
       // ... ë‹¤ë¥¸ ëª¨ë“ˆë“¤
       WinstonModule.forRoot(winstonConfig),
     ],
   })
   export class AppModule {}
   ```

   **main.tsì—ì„œ Winston ì ìš©**
   ```typescript
   // src/main.ts
   import { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';

   async function bootstrap() {
     const app = await NestFactory.create(AppModule, {
       bufferLogs: true,
     });

     // Winston ë¡œê±°ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê±°ë¡œ ì„¤ì •
     app.useLogger(app.get(WINSTON_MODULE_NEST_PROVIDER));

     // ... ë‚˜ë¨¸ì§€ ì„¤ì •
   }
   ```

   **ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± ë° .gitignore ì„¤ì •**
   ```bash
   # ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
   mkdir -p logs/transactions

   # .gitignoreì— ì¶”ê°€
   echo "logs/" >> .gitignore
   ```

2. **ë‚ ì§œ ìœ í‹¸ë¦¬í‹°**
   ```typescript
   // src/shared/utils/date.util.ts
   import { format, addDays, subDays, startOfDay, endOfDay } from 'date-fns';

   export class DateUtil {
     static format(date: Date, pattern: string = 'yyyy-MM-dd HH:mm:ss'): string {
       return format(date, pattern);
     }

     static addDays(date: Date, days: number): Date {
       return addDays(date, days);
     }

     static subDays(date: Date, days: number): Date {
       return subDays(date, days);
     }

     static startOfDay(date: Date): Date {
       return startOfDay(date);
     }

     static endOfDay(date: Date): Date {
       return endOfDay(date);
     }
   }
   ```

2. **ì•”í˜¸í™” ìœ í‹¸ë¦¬í‹°**
   ```typescript
   // src/shared/utils/crypto.util.ts
   import * as bcrypt from 'bcrypt';
   import { createCipheriv, createDecipheriv, randomBytes } from 'crypto';

   export class CryptoUtil {
     private static readonly ALGORITHM = 'aes-256-gcm';
     private static readonly SALT_ROUNDS = 10;

     /**
      * ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
      */
     static async hashPassword(password: string): Promise<string> {
       return bcrypt.hash(password, this.SALT_ROUNDS);
     }

     /**
      * ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
      */
     static async comparePassword(
       password: string,
       hash: string,
     ): Promise<boolean> {
       return bcrypt.compare(password, hash);
     }

     /**
      * AES-256 ì•”í˜¸í™”
      */
     static encrypt(text: string, secretKey: string): string {
       const iv = randomBytes(16);
       const key = Buffer.from(secretKey, 'hex');
       const cipher = createCipheriv(this.ALGORITHM, key, iv);

       let encrypted = cipher.update(text, 'utf8', 'hex');
       encrypted += cipher.final('hex');
       const authTag = cipher.getAuthTag();

       return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
     }

     /**
      * AES-256 ë³µí˜¸í™”
      */
     static decrypt(encryptedData: string, secretKey: string): string {
       const [ivHex, authTagHex, encrypted] = encryptedData.split(':');
       const iv = Buffer.from(ivHex, 'hex');
       const authTag = Buffer.from(authTagHex, 'hex');
       const key = Buffer.from(secretKey, 'hex');

       const decipher = createDecipheriv(this.ALGORITHM, key, iv);
       decipher.setAuthTag(authTag);

       let decrypted = decipher.update(encrypted, 'hex', 'utf8');
       decrypted += decipher.final('utf8');

       return decrypted;
     }
   }
   ```

3. **í˜ì´ì§€ë„¤ì´ì…˜ ìœ í‹¸ë¦¬í‹°**
   ```typescript
   // src/shared/utils/pagination.util.ts
   export interface PaginationOptions {
     page: number;
     limit: number;
   }

   export interface PaginatedResult<T> {
     data: T[];
     meta: {
       total: number;
       page: number;
       limit: number;
       totalPages: number;
       hasNextPage: boolean;
       hasPreviousPage: boolean;
     };
   }

   export class PaginationUtil {
     static paginate<T>(
       data: T[],
       total: number,
       options: PaginationOptions,
     ): PaginatedResult<T> {
       const { page, limit } = options;
       const totalPages = Math.ceil(total / limit);

       return {
         data,
         meta: {
           total,
           page,
           limit,
           totalPages,
           hasNextPage: page < totalPages,
           hasPreviousPage: page > 1,
         },
       };
     }

     static getSkip(page: number, limit: number): number {
       return (page - 1) * limit;
     }
   }
   ```

4. **ê³µí†µ DTO í´ë˜ìŠ¤**
   ```typescript
   // src/shared/dto/pagination.dto.ts
   import { IsOptional, IsInt, Min, Max } from 'class-validator';
   import { Type } from 'class-transformer';

   export class PaginationDto {
     @IsOptional()
     @Type(() => Number)
     @IsInt()
     @Min(1)
     page?: number = 1;

     @IsOptional()
     @Type(() => Number)
     @IsInt()
     @Min(1)
     @Max(100)
     limit?: number = 10;
   }
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] Winston ë¡œê±° ì„¤ì • ì™„ë£Œ
- [ ] ë¡œê·¸ íŒŒì¼ ìƒì„± í™•ì¸ (logs/ ë””ë ‰í† ë¦¬)
- [ ] ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í…ŒìŠ¤íŠ¸
- [ ] ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„± ì™„ë£Œ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] ê³µí†µ DTO ì‘ì„± ì™„ë£Œ

---

### Week 4: ë³´ì•ˆ ì„¤ì • ë° ë¯¸ë“¤ì›¨ì–´

#### Day 16-18: JWT ì¸ì¦ ê°€ë“œ ë° ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´

**ëª©í‘œ**: ì¸ì¦/ì¸ê°€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì™„ì„±

**ì‘ì—… ìˆœì„œ**:

1. **JWT Strategy ì‘ì„±**
   ```typescript
   // src/common/guards/jwt-auth.guard.ts
   import { Injectable, ExecutionContext } from '@nestjs/common';
   import { AuthGuard } from '@nestjs/passport';
   import { Reflector } from '@nestjs/core';
   import { IS_PUBLIC_KEY } from '../decorators/public.decorator';

   @Injectable()
   export class JwtAuthGuard extends AuthGuard('jwt') {
     constructor(private reflector: Reflector) {
       super();
     }

     canActivate(context: ExecutionContext) {
       const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC_KEY, [
         context.getHandler(),
         context.getClass(),
       ]);

       if (isPublic) {
         return true;
       }

       return super.canActivate(context);
     }
   }
   ```

   ```typescript
   // src/common/strategies/jwt.strategy.ts
   import { Injectable, UnauthorizedException } from '@nestjs/common';
   import { PassportStrategy } from '@nestjs/passport';
   import { ExtractJwt, Strategy } from 'passport-jwt';
   import { ConfigService } from '@nestjs/config';

   export interface JwtPayload {
     sub: number;
     email: string;
     roles: string[];
   }

   @Injectable()
   export class JwtStrategy extends PassportStrategy(Strategy) {
     constructor(private configService: ConfigService) {
       super({
         jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
         ignoreExpiration: false,
         secretOrKey: configService.get<string>('jwt.secret'),
       });
     }

     async validate(payload: JwtPayload) {
       if (!payload.sub || !payload.email) {
         throw new UnauthorizedException('Invalid token');
       }

       return {
         userId: payload.sub,
         email: payload.email,
         roles: payload.roles,
       };
     }
   }
   ```

2. **ì—­í•  ê¸°ë°˜ ê°€ë“œ**
   ```typescript
   // src/common/guards/roles.guard.ts
   import { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';
   import { Reflector } from '@nestjs/core';

   export const ROLES_KEY = 'roles';

   @Injectable()
   export class RolesGuard implements CanActivate {
     constructor(private reflector: Reflector) {}

     canActivate(context: ExecutionContext): boolean {
       const requiredRoles = this.reflector.getAllAndOverride<string[]>(
         ROLES_KEY,
         [context.getHandler(), context.getClass()],
       );

       if (!requiredRoles) {
         return true;
       }

       const { user } = context.switchToHttp().getRequest();
       return requiredRoles.some((role) => user.roles?.includes(role));
     }
   }
   ```

   ```typescript
   // src/common/decorators/roles.decorator.ts
   import { SetMetadata } from '@nestjs/common';
   import { ROLES_KEY } from '../guards/roles.guard';

   export const Roles = (...roles: string[]) => SetMetadata(ROLES_KEY, roles);
   ```

3. **ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •**
   ```typescript
   // src/main.ts
   import { NestFactory } from '@nestjs/core';
   import { AppModule } from './app.module';
   import { ValidationPipe, Logger } from '@nestjs/common';
   import { ConfigService } from '@nestjs/config';
   import * as compression from 'compression';
   import helmet from 'helmet';
   import { AllExceptionsFilter } from './common/filters/http-exception.filter';
   import { TransformInterceptor } from './common/interceptors/transform.interceptor';
   import { LoggingInterceptor } from './common/interceptors/logging.interceptor';

   async function bootstrap() {
     const app = await NestFactory.create(AppModule);
     const configService = app.get(ConfigService);
     const logger = new Logger('Bootstrap');

     // ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
     app.use(helmet());
     app.use(compression());

     // CORS ì„¤ì •
     app.enableCors({
       origin: configService.get<string[]>('app.corsOrigins'),
       credentials: true,
     });

     // ê¸€ë¡œë²Œ í”„ë¦¬í”½ìŠ¤
     app.setGlobalPrefix(configService.get<string>('app.apiPrefix'));

     // ê¸€ë¡œë²Œ íŒŒì´í”„
     app.useGlobalPipes(
       new ValidationPipe({
         whitelist: true,
         forbidNonWhitelisted: true,
         transform: true,
         transformOptions: {
           enableImplicitConversion: true,
         },
       }),
     );

     // ê¸€ë¡œë²Œ í•„í„°
     app.useGlobalFilters(new AllExceptionsFilter());

     // ê¸€ë¡œë²Œ ì¸í„°ì…‰í„°
     app.useGlobalInterceptors(
       new LoggingInterceptor(),
       new TransformInterceptor(),
     );

     const port = configService.get<number>('app.port');
     await app.listen(port);

     logger.log(`Application is running on: http://localhost:${port}`);
     logger.log(
       `API prefix: ${configService.get<string>('app.apiPrefix')}`,
     );
   }

   bootstrap();
   ```

4. **Rate Limiting ì„¤ì •**
   ```typescript
   // src/app.module.ts
   import { Module } from '@nestjs/common';
   import { ConfigModule } from '@nestjs/config';
   import { ThrottlerModule } from '@nestjs/throttler';
   import { PrismaModule } from './prisma/prisma.module';
   import { MongodbModule } from './database/mongodb/mongodb.module';
   import { RedisConfigModule } from './database/redis/redis.module';
   import { EventsModule } from './events/events.module';
   import databaseConfig from './config/database.config';
   import jwtConfig from './config/jwt.config';
   import appConfig from './config/app.config';

   @Module({
     imports: [
       ConfigModule.forRoot({
         isGlobal: true,
         load: [databaseConfig, jwtConfig, appConfig],
       }),
       ThrottlerModule.forRoot([
         {
           ttl: 60000, // 1ë¶„
           limit: 100, // 100ê°œ ìš”ì²­
         },
       ]),
       PrismaModule,
       MongodbModule,
       RedisConfigModule,
       EventsModule,
     ],
   })
   export class AppModule {}
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] JWT ì¸ì¦ ê°€ë“œ ì‘ì„± ì™„ë£Œ
- [ ] ì—­í•  ê¸°ë°˜ ê°€ë“œ ì‘ì„± ì™„ë£Œ
- [ ] ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ ì„¤ì • ì™„ë£Œ
- [ ] Rate Limiting í…ŒìŠ¤íŠ¸

---

#### Day 19-20: Swagger API ë¬¸ì„œí™” ë° í—¬ìŠ¤ì²´í¬

**ëª©í‘œ**: API ë¬¸ì„œ ìë™í™” ë° ëª¨ë‹ˆí„°ë§ ì—”ë“œí¬ì¸íŠ¸

**ì‘ì—… ìˆœì„œ**:

1. **Swagger ì„¤ì •**
   ```typescript
   // src/config/swagger.config.ts
   import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';
   import { INestApplication } from '@nestjs/common';

   export function setupSwagger(app: INestApplication): void {
     const config = new DocumentBuilder()
       .setTitle('ì¤‘ê³ ê±°ë˜ì‚¬ì´íŠ¸ API')
       .setDescription('ì¤‘ê³ ê±°ë˜ í”Œë«í¼ ë°±ì—”ë“œ API ë¬¸ì„œ')
       .setVersion('1.0')
       .addBearerAuth(
         {
           type: 'http',
           scheme: 'bearer',
           bearerFormat: 'JWT',
           name: 'JWT',
           description: 'JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”',
           in: 'header',
         },
         'access-token',
       )
       .addTag('Auth', 'ì¸ì¦/ì¸ê°€ ê´€ë ¨ API')
       .addTag('Users', 'ì‚¬ìš©ì ê´€ë¦¬ API')
       .addTag('Products', 'ìƒí’ˆ ê´€ë¦¬ API')
       .addTag('Orders', 'ì£¼ë¬¸ ê´€ë¦¬ API')
       .addTag('Categories', 'ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ API')
       .build();

     const document = SwaggerModule.createDocument(app, config);
     SwaggerModule.setup('api-docs', app, document, {
       swaggerOptions: {
         persistAuthorization: true,
       },
     });
   }
   ```

   ```typescript
   // src/main.tsì— ì¶”ê°€
   import { setupSwagger } from './config/swagger.config';

   async function bootstrap() {
     // ... ê¸°ì¡´ ì½”ë“œ

     // Swagger ì„¤ì •
     setupSwagger(app);

     const port = configService.get<number>('app.port');
     await app.listen(port);

     logger.log(`API Documentation: http://localhost:${port}/api-docs`);
   }
   ```

2. **í—¬ìŠ¤ì²´í¬ ëª¨ë“ˆ ì‘ì„±**
   ```typescript
   // src/health/health.controller.ts
   import { Controller, Get } from '@nestjs/common';
   import { ApiTags, ApiOperation } from '@nestjs/swagger';
   import {
     HealthCheck,
     HealthCheckService,
     PrismaHealthIndicator,
     MongooseHealthIndicator,
   } from '@nestjs/terminus';
   import { PrismaService } from '../prisma/prisma.service';
   import { Public } from '../common/decorators/public.decorator';

   @ApiTags('Health')
   @Controller('health')
   export class HealthController {
     constructor(
       private health: HealthCheckService,
       private prismaHealth: PrismaHealthIndicator,
       private mongooseHealth: MongooseHealthIndicator,
       private prisma: PrismaService,
     ) {}

     @Get()
     @Public()
     @HealthCheck()
     @ApiOperation({ summary: 'ì „ì²´ í—¬ìŠ¤ì²´í¬' })
     check() {
       return this.health.check([
         () => this.prismaHealth.pingCheck('postgresql', this.prisma),
         () => this.mongooseHealth.pingCheck('mongodb'),
       ]);
     }
   }
   ```

**ê²€ì¦ í•­ëª©**:
- [ ] Swagger ë¬¸ì„œ ì ‘ì† í™•ì¸ (http://localhost:3000/api-docs)
- [ ] í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ (GET /health)
- [ ] API ë¬¸ì„œ ìë™ ìƒì„± í™•ì¸

---

## âœ… Phase 1 ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Week 1 ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Docker Compose í™˜ê²½ êµ¬ì¶• ì™„ë£Œ
- [ ] ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…Œì´ë„ˆ ì •ìƒ ë™ì‘
- [ ] í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ìƒì„±
- [ ] ê³µí†µ ëª¨ë“ˆ(interceptor, filter, pipe, decorator) ì‘ì„± ì™„ë£Œ
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ

### Week 2 ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Prisma ìŠ¤í‚¤ë§ˆ ì‘ì„± ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
- [ ] PrismaService ëª¨ë“ˆ ìƒì„±
- [ ] MongoDB ìŠ¤í‚¤ë§ˆ ì‘ì„±
- [ ] MongoDB ì—°ê²° ëª¨ë“ˆ ìƒì„±
- [ ] Redis ì—°ê²° ëª¨ë“ˆ ìƒì„±

### Week 3 ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] RabbitMQ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•
- [ ] ì´ë²¤íŠ¸ ë°œí–‰/êµ¬ë… í…ŒìŠ¤íŠ¸
- [ ] **Winston ë¡œê±° ì„¤ì • ì™„ë£Œ** â­
- [ ] ë¡œê·¸ íŒŒì¼ ìƒì„± ë° ë¡œí…Œì´ì…˜ í…ŒìŠ¤íŠ¸
- [ ] ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ ê²€ì¦
- [ ] ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±
- [ ] ê³µí†µ DTO í´ë˜ìŠ¤ ì‘ì„±

### Week 4 ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] JWT ì¸ì¦ ê°€ë“œ ì‘ì„±
- [ ] ì—­í•  ê¸°ë°˜ ê°€ë“œ ì‘ì„±
- [ ] ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [ ] Rate Limiting ì„¤ì •
- [ ] Swagger ë¬¸ì„œí™” ì„¤ì •
- [ ] í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ì‘ì„±

---

## ğŸš€ Phase 2: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ (5-10ì£¼)

> **ë‹¤ìŒ ë‹¨ê³„ ê³„íš**
> Phase 1 ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ê°€ ì™„ì„±ë˜ë©´, Phase 2ì—ì„œëŠ” ë‹¤ìŒ ìˆœì„œë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤:
>
> 1. **Week 5-6**: ì‚¬ìš©ì ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œ (íšŒì›ê°€ì…, ë¡œê·¸ì¸, JWT, OAuth)
> 2. **Week 7-8**: ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ (CRUD, íŒŒì¼ ì—…ë¡œë“œ, ê²€ìƒ‰)
> 3. **Week 9-10**: ì£¼ë¬¸ ë° ê²°ì œ ì‹œìŠ¤í…œ (ì£¼ë¬¸ ìƒì„±, ê²°ì œ ì—°ë™, Saga íŒ¨í„´)

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ê°€ì´ë“œ

### Phase 1 ì™„ë£Œ í›„ ì§„í–‰ ìˆœì„œ

1. **ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ê²€ì¦**
   - ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
   - ê³µí†µ ëª¨ë“ˆ ë™ì‘ í™•ì¸
   - API í—¬ìŠ¤ì²´í¬ í†µê³¼

2. **Phase 2 ì¤€ë¹„**
   - ì¸ì¦ ëª¨ë“ˆ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„¤ê³„ ë¬¸ì„œ ì‘ì„±
   - API ëª…ì„¸ì„œ ì‘ì„±
   - í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±

3. **ê°œë°œ ì‹œì‘**
   - Week 5ë¶€í„° ì‚¬ìš©ì ì¸ì¦ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
   - TDD ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¨¼ì € ì‘ì„±
   - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ â†’ í†µí•© í…ŒìŠ¤íŠ¸ ìˆœì„œë¡œ ì§„í–‰

---

## ğŸ“Š ì„±ê³µ ì§€í‘œ

### Phase 1 ì™„ë£Œ ê¸°ì¤€
- [ ] Docker í™˜ê²½ì—ì„œ ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ì‹¤í–‰
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° 100% ì„±ê³µ
- [ ] **Winston ë¡œê±° ì •ìƒ ë™ì‘ ë° íŒŒì¼ ë¡œê¹… í™•ì¸** â­
- [ ] Swagger ë¬¸ì„œ ìë™ ìƒì„±
- [ ] í—¬ìŠ¤ì²´í¬ API ì •ìƒ ì‘ë‹µ
- [ ] ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ ì ìš© ì™„ë£Œ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ >70%

---

**ë¬¸ì„œ ë²„ì „**: v1.0
**ì‘ì„±ì¼**: 2025-10-15
**ë‹¤ìŒ ë¦¬ë·°**: Phase 1 ì™„ë£Œ í›„
**ìŠ¹ì¸ í•„ìš”**: ê°œë°œíŒ€, PM
