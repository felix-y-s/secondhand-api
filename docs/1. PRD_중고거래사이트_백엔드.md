# PRD: 중고거래사이트 백엔드 API

## 📋 프로젝트 개요

### 프로젝트 정보
- **프로젝트명**: 중고거래사이트 백엔드 API
- **버전**: v1.0.0
- **기술 스택**: NestJS + Express, PostgreSQL, MongoDB, Redis
- **목표**: 안전하고 확장 가능한 중고거래 플랫폼 백엔드 구축

### 비즈니스 목표
- 안전한 중고거래 환경 제공
- 사기 방지 및 신뢰성 보장
- 확장 가능한 아키텍처 구현
- 법적 규정 준수 (전자상거래법, 개인정보보호법)

## 🎯 핵심 기능 요구사항

### 1. 사용자 관리 시스템

#### 1.1 인증/인가
- **기능**: JWT 기반 인증, OAuth 2.0, 2FA 지원
- **요구사항**:
  - 회원가입/로그인/로그아웃
  - 소셜 로그인 (Google, Kakao, Naver)
  - 비밀번호 재설정
  - 역할 기반 권한 관리 (구매자/판매자/관리자)
- **데이터**: PostgreSQL (Users, Roles, Permissions)

#### 1.2 프로필 관리
- **기능**: 사용자 프로필, 신뢰도 시스템, 거래 히스토리
- **요구사항**:
  - 개인정보 관리 (암호화 저장)
  - 신뢰도 점수 계산 알고리즘
  - 거래 히스토리 조회
  - 평점 및 리뷰 관리
- **데이터**: PostgreSQL + MongoDB (프로필 확장 정보)

### 2. 상품 관리 시스템

#### 2.1 상품 CRUD
- **기능**: 상품 등록, 수정, 삭제, 조회
- **요구사항**:
  - 다중 이미지 업로드 (최대 10장)
  - 실시간 재고 관리
  - 상품 상태 관리 (판매중/예약중/거래완료)
  - 상품 승인/반려 시스템
- **데이터**: MongoDB (상품 상세) + PostgreSQL (재고/상태)

#### 2.2 카테고리 & 검색
- **기능**: 계층형 카테고리, 전문검색, 필터링
- **요구사항**:
  - 3단계 카테고리 시스템
  - Elasticsearch 기반 전문검색
  - 가격/지역/카테고리 필터링
  - 자동완성 검색어 제안
- **데이터**: PostgreSQL (카테고리) + Elasticsearch (검색 인덱스)

### 3. 거래 시스템

#### 3.1 주문 처리
- **기능**: 장바구니, 주문서 생성, 결제 연동
- **요구사항**:
  - 동시 주문 방지 (락킹 메커니즘)
  - 주문 상태 추적 (주문→결제→배송→완료)
  - 에스크로 서비스 연동
  - 주문 취소/환불 처리
- **데이터**: PostgreSQL (Orders, OrderItems, Payments)

#### 3.2 배송 관리
- **기능**: 택배사 연동, 배송 추적
- **요구사항**:
  - 택배사 API 연동 (CJ대한통운, 롯데택배)
  - 배송비 자동 계산
  - 배송 상태 실시간 업데이트
  - 배송 완료 알림
- **데이터**: PostgreSQL (Shipments) + 외부 API

## 🛡️ 보안 & 컴플라이언스 요구사항

### 데이터 보안
- **암호화**: 개인정보 AES-256 암호화
- **통신 보안**: HTTPS 강제, TLS 1.3
- **API 보안**: Rate Limiting (100req/min), CORS 설정
- **입력 검증**: SQL Injection, XSS, CSRF 방지

### 법적 규정 준수
- **개인정보보호**: GDPR 준수, 개인정보 처리방침
- **전자상거래법**: 필수 고지사항, 약관 동의
- **PCI DSS**: 결제 데이터 보안 표준 준수

## ⚡ 성능 & 확장성 요구사항

### 성능 목표
- **응답 시간**: API 평균 <200ms, 95th percentile <500ms
- **처리량**: 동시 사용자 1,000명, 일 거래량 10,000건
- **가용성**: 99.9% 업타임 (월 43분 다운타임)

### 확장성 설계
- **수평 확장**: 로드밸런싱, 마이크로서비스 아키텍처
- **데이터베이스**: 읽기 복제본, 샤딩 준비
- **캐싱**: Redis 클러스터, CDN 연동

## 🔍 부가 기능 요구사항

### 검색 & 추천
- **Elasticsearch**: 상품 전문검색, 자동완성
- **추천 시스템**: 협업 필터링, 콘텐츠 기반 추천
- **AI 기반**: 상품 분류 자동화, 가격 추천

### 커뮤니케이션
- **실시간 채팅**: WebSocket, 메시지 히스토리
- **알림 시스템**: 푸시 알림, 이메일, SMS
- **리뷰 시스템**: 평점, 댓글, 신고 기능

## 🏗️ 기술 아키텍처

### 기술 스택
```yaml
Backend Framework: NestJS + Express
Primary Database: PostgreSQL (구조화된 데이터)
Document Database: MongoDB (비구조화된 데이터)
Cache & Sessions: Redis
Search Engine: Elasticsearch
Message Queue: RabbitMQ
File Storage: AWS S3
```

### 데이터베이스 전략

#### PostgreSQL (ACID 중요 데이터)
```sql
- Users: 사용자 정보, 인증 데이터
- Orders: 주문, 결제, 거래 상태
- Categories: 상품 카테고리 계층
- Transactions: 금융 거래, 정산 데이터
- Shipments: 배송 정보
```

#### MongoDB (유연한 스키마)
```javascript
- Products: 상품 상세정보, 메타데이터
- Reviews: 리뷰, 평점, 댓글
- Messages: 채팅 메시지
- ActivityLogs: 사용자 행동 로그
- SearchHistory: 검색 기록
```

#### Redis (고성능 캐싱)
```
- Sessions: JWT 세션 관리
- Cache: 인기 상품, 검색 결과
- Queues: 비동기 작업 처리
- RateLimit: API 호출 제한
```

## 📊 데이터 무결성 & 거래 추적성

### 거래 무결성
- **ACID 트랜잭션**: 결제-재고 동시 업데이트
- **이중 지출 방지**: 동시 구매 요청 락킹
- **재고 일관성**: 실시간 재고 동기화

### Audit Trail
- **거래 로그**: 모든 거래 단계별 기록
- **변경 이력**: 상품/가격 변경 추적
- **사용자 행동**: 로그인, 조회, 구매 패턴

### 분쟁 해결
- **증거 보전**: 거래 과정 기록 보존
- **타임라인 복원**: 거래 진행 과정 추적
- **책임 추적**: 각 단계별 책임자 기록

## 🌍 지역 기반 서비스

### 위치 정보 처리
- **GPS 서비스**: 좌표 수집, 주소 변환
- **지역 필터링**: 반경 내 상품 검색
- **배송비 계산**: 거리 기반 배송비 산정
- **안전 거래**: 공공장소 만남 장소 추천

## 🚨 사기 방지 & 신뢰성

### 사기 탐지
- **AI 기반 감지**: 이상 패턴 실시간 모니터링
- **머신러닝**: 사기 패턴 학습, 정확도 개선
- **위험도 평가**: 거래별 리스크 스코어링

### 신뢰도 시스템
- **본인 인증**: 휴대폰, 신분증, 계좌 인증
- **에스크로**: 안전 결제, 조건부 송금
- **평판 관리**: 거래 후기, 신뢰도 점수

## 🔄 이벤트 기반 아키텍처

### 비동기 처리
- **이벤트 소싱**: 거래 상태 변경 이벤트
- **메시지 큐**: RabbitMQ 비동기 작업
- **워크플로우**: 복잡한 거래 프로세스 자동화
- **이벤트 스트리밍**: 실시간 데이터 분석

## 🔗 외부 서비스 연동

### 필수 연동 서비스
- **PG사**: 결제 게이트웨이 (토스페이먼츠, KG이니시스)
- **택배사**: 송장 발행, 배송 추적 API
- **본인인증**: NICE, KCB 공인인증기관
- **SMS/알림톡**: 거래 상태 알림

### 규제 준수
- **금융감독원**: 전자금융거래법
- **통신판매업**: 사업자 등록 연동
- **개인정보보호**: 처리방침, 동의 관리

## 📱 사용자 경험 최적화

### 다채널 지원
- **모바일 앱**: React Native/Flutter API 지원
- **웹 플랫폼**: RESTful API, GraphQL
- **다국어**: i18n 지원, 통화 변환
- **접근성**: 웹 접근성 지침 준수

### 데이터 기반 운영
- **A/B 테스팅**: 기능 토글, 사용자 그룹 테스트
- **분석**: 사용자 행동 분석, BI 연동
- **고객 지원**: 챗봇, FAQ, 티켓 시스템

## 🚀 운영 & 유지보수

### 모니터링
- **로그 관리**: Winston 중앙화 로깅
- **성능 모니터링**: APM, 메트릭 수집
- **알림**: 장애 감지, 임계값 알림

### 배포 & CI/CD
- **자동화**: GitHub Actions, Docker 컨테이너
- **테스트**: 단위/통합/E2E 테스트 자동화
- **백업**: 정기 백업, 재해 복구 계획

## 📈 성공 지표 (KPI)

### 비즈니스 메트릭
- **거래 성공률**: >95%
- **사용자 만족도**: 평점 4.5/5.0 이상
- **사기 발생률**: <0.1%
- **응답 시간**: API 평균 <200ms

### 기술 메트릭
- **가용성**: 99.9% 업타임
- **처리량**: 1,000 TPS
- **에러율**: <0.1%
- **테스트 커버리지**: >80%

## 🛣️ 개발 로드맵

### Phase 1: 기반 인프라 (4주)
- 데이터베이스 설계 및 ORM 설정
- Docker 환경 구성
- 기본 모듈 구조 설계
- CI/CD 파이프라인 구축

### Phase 2: 핵심 기능 (6주)
- 사용자 인증/인가 시스템
- 상품 CRUD 및 파일 업로드
- 주문/결제 시스템
- 기본 보안 설정

### Phase 3: 고급 기능 (4주)
- 검색 엔진 연동
- 실시간 채팅 시스템
- 알림 시스템
- 추천 엔진

### Phase 4: 최적화 & 배포 (2주)
- 성능 최적화
- 보안 강화
- 모니터링 시스템
- 프로덕션 배포

## 🔧 기술 요구사항

### 필수 의존성
```json
{
  "framework": "@nestjs/core ^11.0.1",
  "database": {
    "postgresql": "@nestjs/typeorm, pg, typeorm",
    "mongodb": "@nestjs/mongoose, mongoose",
    "redis": "@nestjs/redis, redis"
  },
  "authentication": "@nestjs/jwt, @nestjs/passport",
  "validation": "class-validator, class-transformer",
  "configuration": "@nestjs/config",
  "file_upload": "@nestjs/platform-express, multer",
  "caching": "@nestjs/cache-manager",
  "security": "@nestjs/throttler, helmet"
}
```

### 인프라 요구사항
- **컨테이너**: Docker + Docker Compose
- **데이터베이스**: PostgreSQL 14+, MongoDB 6+, Redis 7+
- **검색 엔진**: Elasticsearch 8+
- **메시지 큐**: RabbitMQ 3.12+
- **파일 스토리지**: AWS S3 또는 호환 스토리지

### 성능 요구사항
- **메모리**: 최소 2GB, 권장 4GB
- **CPU**: 최소 2 Core, 권장 4 Core
- **스토리지**: SSD, 최소 100GB
- **네트워크**: 1Gbps 대역폭

## 🔒 보안 요구사항

### 데이터 보안
- **암호화**: AES-256 (개인정보), bcrypt (비밀번호)
- **통신**: HTTPS 강제, TLS 1.3
- **데이터베이스**: 연결 암호화, 접근 제한

### API 보안
- **인증**: JWT Bearer Token
- **Rate Limiting**: IP별 100req/min
- **CORS**: 허용 도메인 제한
- **입력 검증**: DTO 기반 검증, SQL Injection 방지

### 컴플라이언스
- **개인정보보호법**: 동의 관리, 데이터 최소 수집
- **전자상거래법**: 쿨링오프, 환불 정책
- **PCI DSS**: 결제 데이터 보안 (Level 1)

## 📋 위험 요소 & 대응 방안

### 기술적 위험
- **데이터 일관성**: 분산 트랜잭션 관리
- **성능 병목**: 캐싱 전략, DB 최적화
- **보안 취약점**: 정기 보안 감사, 침투 테스트

### 비즈니스 위험
- **사기 거래**: AI 기반 실시간 감지
- **법적 리스크**: 법무팀 검토, 규정 준수
- **확장성**: 마이크로서비스 아키텍처 준비

## 📝 추가 고려사항

### 운영 고려사항
- **24/7 모니터링**: 장애 대응 체계
- **백업 전략**: 일 2회 자동 백업
- **재해 복구**: RTO 4시간, RPO 1시간

### 향후 확장
- **글로벌 서비스**: 다국가 서비스 확장 준비
- **B2B 서비스**: 기업 고객 대상 서비스
- **AI 강화**: 상품 분류, 가격 예측, 사기 탐지 고도화

---

**문서 버전**: v1.0  
**작성일**: 2025-08-31  
**검토자**: 개발팀  
**승인자**: PM, CTO