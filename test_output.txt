
> secondhand-api@0.0.1 test:e2e
> jest --config ./jest-e2e.json src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts

  console.log
    [32mâœ”[0m [33mConsole Ninja[0m extension is connected to [33mNest.js[0m, see [36mhttps://tinyurl.com/2vt8jxzw[0m

      at new kL (../../.windsurf/extensions/wallabyjs.console-ninja-1.0.498-universal/out/buildHook/index.js:1:3989135)

FAIL src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts
  JwtAuthGuard (E2E)
    @Public() ë°ì½”ë ˆì´í„°
      âœ“ Public ì—”ë“œí¬ì¸íŠ¸ëŠ” í† í° ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ (19 ms)
      âœ“ í´ë˜ìŠ¤ ë ˆë²¨ Guardê°€ ìˆì–´ë„ @Public()ì´ ìš°ì„ í•œë‹¤ (3 ms)
    JWT Access Token ì¸ì¦
      ì„±ê³µ ì¼€ì´ìŠ¤
        âœ“ ìœ íš¨í•œ Access Tokenìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•œë‹¤ (5 ms)
        âœ“ í•„ìˆ˜ í•„ë“œë§Œ ìˆì–´ë„ ì¸ì¦ì— ì„±ê³µí•œë‹¤ (2 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - í† í° ì—†ìŒ/í˜•ì‹ ì˜¤ë¥˜
        âœ“ í† í°ì´ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
        âœ“ Bearer ìŠ¤í‚¤ë§ˆê°€ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)
        âœ“ ì˜ëª»ëœ í˜•ì‹ì˜ í† í°ì´ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - í† í° ë§Œë£Œ
        âœ“ ë§Œë£Œëœ í† í°ì´ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - ì˜ëª»ëœ ì„œëª…
        âœ“ ë‹¤ë¥¸ secretìœ¼ë¡œ ì„œëª…ëœ í† í°ì´ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - ì˜ëª»ëœ í† í° íƒ€ì…
        âœ• Refresh Tokenìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - í•„ìˆ˜ í•„ë“œ ëˆ„ë½
        âœ“ sub(userId)ê°€ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)
        âœ“ emailì´ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
        âœ“ roleì´ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)
    JWT Refresh Token ì¸ì¦
      ì„±ê³µ ì¼€ì´ìŠ¤
        âœ• ìœ íš¨í•œ Refresh Tokenìœ¼ë¡œ refresh ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•œë‹¤ (2 ms)
      ì‹¤íŒ¨ ì¼€ì´ìŠ¤
        âœ• Access Tokenìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (2 ms)
        âœ• ë§Œë£Œëœ Refresh Tokenì´ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)
        âœ• Refresh Tokenì´ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤ (1 ms)

  â— JwtAuthGuard (E2E) â€º JWT Access Token ì¸ì¦ â€º ì‹¤íŒ¨ ì¼€ì´ìŠ¤ - ì˜ëª»ëœ í† í° íƒ€ì… â€º Refresh Tokenìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤

    expect(received).toContain(expected) // indexOf

    Expected substring: "ìœ íš¨í•˜ì§€ ì•Šì€ í† í° íƒ€ì…"
    Received string:    "jwt ì¸ì¦ì˜¤ë¥˜: invalid signature"

      232 |           .set('Authorization', `Bearer ${refreshToken}`)
      233 |           .expect(401)
    > 234 |           .expect((res) => {
          |            ^
      235 |             expect(res.body.message).toContain('ìœ íš¨í•˜ì§€ ì•Šì€ í† í° íƒ€ì…');
      236 |           });
      237 |       });

      at Object.<anonymous> (src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:234:12)
      ----
      at src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:235:38
      at node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  â— JwtAuthGuard (E2E) â€º JWT Refresh Token ì¸ì¦ â€º ì„±ê³µ ì¼€ì´ìŠ¤ â€º ìœ íš¨í•œ Refresh Tokenìœ¼ë¡œ refresh ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•œë‹¤

    expected 201 "Created", got 401 "Unauthorized"

      323 |           .post('/test/auth/refresh')
      324 |           .set('Authorization', `Bearer ${refreshToken}`)
    > 325 |           .expect(201)
          |            ^
      326 |           .expect((res) => {
      327 |             expect(res.body.message).toBe('refresh endpoint');
      328 |             expect(res.body.user).toMatchObject({

      at Object.<anonymous> (src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:325:12)
      ----
      at Test._assertStatus (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  â— JwtAuthGuard (E2E) â€º JWT Refresh Token ì¸ì¦ â€º ì‹¤íŒ¨ ì¼€ì´ìŠ¤ â€º Access Tokenìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤

    expect(received).toContain(expected) // indexOf

    Expected substring: "ìœ íš¨í•˜ì§€ ì•Šì€ í† í° íƒ€ì…"
    Received string:    "jwt ì¸ì¦ì˜¤ë¥˜: invalid signature"

      354 |           .set('Authorization', `Bearer ${accessToken}`)
      355 |           .expect(401)
    > 356 |           .expect((res) => {
          |            ^
      357 |             expect(res.body.message).toContain('ìœ íš¨í•˜ì§€ ì•Šì€ í† í° íƒ€ì…');
      358 |           });
      359 |       });

      at Object.<anonymous> (src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:356:12)
      ----
      at src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:357:38
      at node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  â— JwtAuthGuard (E2E) â€º JWT Refresh Token ì¸ì¦ â€º ì‹¤íŒ¨ ì¼€ì´ìŠ¤ â€º ë§Œë£Œëœ Refresh Tokenì´ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤

    expect(received).toContain(expected) // indexOf

    Expected substring: "jwt expired"
    Received string:    "jwt ì¸ì¦ì˜¤ë¥˜: invalid signature"

      375 |           .set('Authorization', `Bearer ${expiredRefreshToken}`)
      376 |           .expect(401)
    > 377 |           .expect((res) => {
          |            ^
      378 |             expect(res.body.message).toContain('jwt expired');
      379 |           });
      380 |       });

      at Object.<anonymous> (src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:377:12)
      ----
      at src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:378:38
      at node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  â— JwtAuthGuard (E2E) â€º JWT Refresh Token ì¸ì¦ â€º ì‹¤íŒ¨ ì¼€ì´ìŠ¤ â€º Refresh Tokenì´ ì—†ìœ¼ë©´ 401 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤

    expect(received).toContain(expected) // indexOf

    Expected substring: "Refresh Tokenì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
    Received string:    "jwt ì¸ì¦ì˜¤ë¥˜: No auth token"

      384 |           .post('/test/auth/refresh')
      385 |           .expect(401)
    > 386 |           .expect((res) => {
          |            ^
      387 |             expect(res.body.message).toContain(
      388 |               'Refresh Tokenì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
      389 |             );

      at Object.<anonymous> (src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:386:12)
      ----
      at src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts:387:38
      at node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 12 passed, 17 total
Snapshots:   0 total
Time:        1.252 s, estimated 4 s
Ran all test suites matching src/modules/auth/guards/jwt-auth-guard.e2e.spec.ts.
